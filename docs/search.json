[
  {
    "objectID": "fct_standardisation.html",
    "href": "fct_standardisation.html",
    "title": "8  Food Composition Table & Databases: Standardisation",
    "section": "",
    "text": "8.1 Introduction",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Food Composition Table & Databases: Standardisation</span>"
    ]
  },
  {
    "objectID": "fct_standardisation.html#introduction",
    "href": "fct_standardisation.html#introduction",
    "title": "8  Food Composition Table & Databases: Standardisation",
    "section": "",
    "text": "Figure 8.1\n\n\n\n\n8.1.1 Selecting food composition data\nWhen selecting the food composition table or database (FCT) that will be used, it is good to reflect on the following questions:\n\nRelevancy for the study/context (e.g., is that FCT/FCBD geographically and culturally close to our survey scope?).\nFCT availability & missing values (e.g., are relevant foods and nutrients reported?).\nData quality and reporting (e.g., what are the method of analysis and metadata available?).\n\n\n\n8.1.2 Objective\nThis document provide, together with the template document, the steps and description for cleaning and standardising FCTs from diverse sources. More details about the cleaned data that can be found in the repository is documented in this folder (documentation).\nFor easy navigation and use of this script it is recommended to use Rstudio. In RStudio please click the “Show Document Outline” button to the right of the source button, at the top right of this window. This will allow for easier navigation of the script.\n\n\n8.1.3 Environment Prep\nFirst we need to check what (Section 4.2) are installed. If you have run this template before in this RStudio project and are sure these packages are already installed, you can comment out (put a hash at the start of) line 20, and skip it.\n\n# Run this to clean the environment\nrm(list = ls())\n\n# Loading libraries\n\nlibrary(readxl) # reading and writing excel files\nlibrary(stringr) # character string handling\nlibrary(dplyr) # cleaning data\nlibrary(here) # file management",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Food Composition Table & Databases: Standardisation</span>"
    ]
  },
  {
    "objectID": "fct_standardisation.html#obtaining-the-raw-fct-file",
    "href": "fct_standardisation.html#obtaining-the-raw-fct-file",
    "title": "8  Food Composition Table & Databases: Standardisation",
    "section": "8.2 Obtaining the raw (FCT) file",
    "text": "8.2 Obtaining the raw (FCT) file\n\n8.2.1 Data license\nBefore using any dataset, we recommend to check licensing conditions & record the data source, you can use the README template.\n\n\n8.2.2 Downloading the data\nIf the data is publicly available online, usually you only need to run the code below to obtain the raw files. Remember you only need to do it the first time! Then, the data will be stored in the folder of your choice (see below).\nFor instance, many raw files can be found provided by the FAO here, in various formats.\nOnce the link to the data is found, check what file type it is, and paste the direct file link to replace the fill-in value below.\n\n\n8.2.3 File names conventions\nWe advise to use the ISO code (2 digits) (see ISO 3166 2-alpha code for further information) of the country or the region of the FCT scope, plus the two last digits of the year of publication to name, both the folder which will contain the data and the scripts related to the FCT. For instance, Western Africa FCT, 2019 will be coded as WA19. This will help with the interoperability, reusability and findability of the data. Also, to streamline the work in the future. That name convention will be used also as the identifier of the FCT.\nNote that you need to create the folders to store the FCT.\n\nf &lt;- \"https://www.fao.org/fileadmin/user_upload/faoweb/2020/WAFCT_2019.xlsx\"\n \n download.file(f, \n             destfile = here::here(\"data\", # data folder\n                                   'WA19', #FCT folder\n                                   #FCT file\n                                   \"WAFCT_2019.xlsx\"),  \n             method=\"wininet\", #use \"curl\" for OS X / Linux, \"wininet\" for Windows\n             mode=\"wb\")\n\nIf using an RStudio project, and you put the .R file and the data file in the same folder as the RStudio project or within a subfolder, files and folders are much easier to navigate as your project/here::here location automatically moves to the main project folder.\n\n\n8.2.4 Getting your file into R\nIf you are using an RStudio project but used a different download method, or already have the file you want to process on your computer, or are using base R we can still use the here::here() function, however we will have to find the file first.\nThe best practice is to put the file in the same folder as this script, or in a folder within the project. If this is done, then use here::here() to find your current working directory, and then navigate to the file’s folder. More information about the here package can be found here.\n\n# Run this script to see where is your directory\nhere::here()\n\nIn order to navigate R to the file, you have to include each subfolder between the here::here() location and the file itself. So for our file structure, we have the ‘data’ folder, the ‘FCT’ folder and the FCT file).\nFind your file in your project, and then direct here::here() to it.\n\n# This identifies the file and file path, and saves it as a variable\nFCT_file_location &lt;- here::here('data','WA19', \"WAFCT_2019.xlsx\")",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Food Composition Table & Databases: Standardisation</span>"
    ]
  },
  {
    "objectID": "fct_standardisation.html#importing-the-data-loading-the-data",
    "href": "fct_standardisation.html#importing-the-data-loading-the-data",
    "title": "8  Food Composition Table & Databases: Standardisation",
    "section": "8.3 Importing the data (loading the data)",
    "text": "8.3 Importing the data (loading the data)\n\n8.3.1 Importing Files\nAfter having found the file on your system that we want to import it. FCT files come in many different forms - the most common being “.xlsx” files and “.csv” files. Methods to import both of these file types will be covered - please navigate to the relevant subsection.\nDuring import, a identifier for the FCT is created and added to the table. Please replace ‘WA19’ from the next code chunck with the FCT id., comprised of the countries ISO 3166 2-alpha code, and the year the FCT was produced (e.g. for the Western Africa FCT from 2019, the reference would be ‘MWA9’).\nThis should be the same as the folder name explained in (section 1.3)[link-to-section].\n\n# This is an example of the name \nFCT_id &lt;- 'WA19' # Change two first letter for your ISO 2 code & the two digits for the last two digits of the year of publication.\n\nIf you used the download method above Section 8.2.2 then we will see the same location as specified there to specify the file. We can simply use the object FCT_file_location, or copy the contents inside the here::here() and use it to fill the here::here() in the line of code below.\n\nImporting .xlsx files\nFor the spreadsheet (excel-type of files), first, you need to check what information is provided and which of the sheet is providing the FC data.\n\n# Checking the sheets\n\nreadxl::excel_sheets(FCT_file_location)\n\ndata.df &lt;- readxl::read_excel(FCT_file_location, #The file location, as                            identified in section 2.1\n                              sheet = 5  # Change to the excel sheet where                              the FCT is stored in the excel file\n                              ) %&gt;%  \n  mutate(source_fct = FCT_id)  #Creates the source_fct column and fills with                 a id for this FCT, as filled in in section 2.2. \n\n\n\nImporting .csv files\n\ndata.df &lt;- read.csv2(FCT_file_location, #The file location, as identified in section 2.1\n                     sep = \",\") %&gt;%  # Replace w/ other symbol if needed\n  mutate(source_fct = FCT_id) #Creates the source_fct column and fills with a id for this FCT, as filled in in section 2.2. \n\nOnce imported, it is important to check the data.frame created from the csv, by using head(data.df) or clicking on its entry in the Environment panel of RStudio (This second option is not advised with very large files, however, as it can be slow).\nIf the data shown by doing this has all its columns combined, with a symbol in-between, then that symbol (e.g. ‘;’) is the separator for that csv. Replace comma in the sep = \",\" line from the code block above with the new symbol, and run the entire block again.\n\n\nVisually checking the data\n\n# Checking the dataframe\nhead(data.df) \n\n\n\nChecking the loaded data\n\n\n\n\n\n\nQuestion\n\n\n\nHow many rows & columns have the data?\n\n\nYou can use the function dim() to answer to check the number of rows and column.\n\n\n\n\n\n\nAnswer\n\n\n\n\n\n\ndim(data.df) # rows & columns\n\n\n\n\nOther useful functions to evaluate the structure of the data are:\n\n# Structure (variable names, class, etc.)\nstr(data.df)\n\n# Checking the last rows and columns\ntail(data.df) \n\n\n\n\n\n\n\nUsing View()\n\n\n\nThe function View() can be use for opening the dataframe in a tab. However, if the dataset is very very big, it may crash the R session.\n\n\nAfter checking that the correct FCT file have loaded the, then proceed. If not, find the correct file and import it instead.",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Food Composition Table & Databases: Standardisation</span>"
    ]
  },
  {
    "objectID": "fct_standardisation.html#cleaning-tidying-and-standardising-the-data",
    "href": "fct_standardisation.html#cleaning-tidying-and-standardising-the-data",
    "title": "8  Food Composition Table & Databases: Standardisation",
    "section": "8.4 Cleaning (tidying) and standardising the data",
    "text": "8.4 Cleaning (tidying) and standardising the data\n\n8.4.1 Formatting FCT into a tabular format\n\nTrimming dataframe rows\nRunning this will trim down the table to only include the row numbers between x and y - replace x and y with your desired values. If you wanted to include multiple row ranges, that is also possible - use comments to differentiate between different row ranges and individual rows. e.g. if you wanted to include rows a:b, row c, row e, and rows g:x, then the code would be slice(a:b, c, e, g:x).\n\ndata.df %&gt;% slice(1:5) %&gt;% knitr::kable()\n\n\n\nTrimming dataframe columns\nIf you only wish to include certain columns/nutrients, then you might wish to remove the unnecessary columns to make the dataframe easier to read and manage. This can be done through 2 methods; either by selecting the names of the columns you want to keep, or by selecting the names of the columns you want to remove.\n\n\nKeep specified columns only\nThis method requires creating a list of column names you want to keep - for #example the line below would select the columns ‘Energy_kcal’, ‘Fatg’, ‘Protein_g’, but nothing else. If you wish to trim the columns this way, replace the items in the first line with the column names you want to keep, then run the code block below.\n\n# Storing the variables you want to keep\ncolumns_to_keep &lt;- c('Scientific name', 'Energy\\r\\n(kJ)')\n\n# Selecting the variables\ndata.df %&gt;% select(columns_to_keep) %&gt;% \n  head(5) %&gt;% \n  knitr::kable()\n\n\n\nRemove specified columns, keep all others\nSometimes it is easier to list the columns you want to remove, rather than the ones you want to keep. The code block below identifies the columns to be removed (‘VitB12_mcg’ and ‘Calcium_mg’ in the example), and then removes them. If you wish to trim the columns this way, replace the items in the first line with the column names you want to remove, then run the code block below.\nThis works in a similar way to the codeblock in section 3.3.1, however by putting an exclamation mark (!) before the list of columns, it inverts the selection - instead of instructing R to keep only the listed columns (as with the codeblock above), it instructs R to keep all columns but the listed ones.\n\n# Selecting the variables that you don't want to keep\ncolumns_to_remove &lt;- c('Food name in French', 'Sum of proximate components\\r\\n(g)') \n\ndata.df %&gt;% select(!columns_to_remove) %&gt;% \n  head(5) %&gt;% \n  knitr::kable()\n\n\n\n\n8.4.2 Creating food groups variable\nSome food composition tables reported food groups that were placed as the first row of each category, however that it is not a data structure that can be used, as we need one column per variable. Hence, the food group names are extracted from the rows, and are allocated as a new attribute of each food (e.g., fish and fishery products to catfish). The food groups are stored in a new column (food_group).\nThis process requires multiple steps, each covered in their own subsections below: Extracting food group names, Creating the variable, and checking changes in the structure.\n\nExtracting food group names\n\n#Creates a list of the food groups using their unique row structure in the table to identify them\n\nfgroup &lt;- data.df %&gt;% \n  filter(is.na(`Food name in English`), !is.na(Code)) %&gt;%\n  pull(Code) %&gt;%\n  stringr::str_split_fixed( '/', n = 2) %&gt;% \n  as_tibble() %&gt;%\n  pull(V1) \n\ngroup.id &lt;-  unique(str_extract(data.df$Code, \"^[:digit:]{2}\\\\_\"))[-1]",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Food Composition Table & Databases: Standardisation</span>"
    ]
  },
  {
    "objectID": "fct_standardisation.html#further-readings",
    "href": "fct_standardisation.html#further-readings",
    "title": "8  Food Composition Table & Databases: Standardisation",
    "section": "9.1 Further readings",
    "text": "9.1 Further readings\n\nCharrondiere, U.R., Stadlmayr, B., Grande, F., Vincent, A., Oseredczuk, M., Sivakumaran, S., Puwastien, P., Judprasong, K., Haytowitz, D., Gnagnarella, P. 2023. FAO/INFOODS Evaluation framework to assess the quality of published food composition tables and databases - User guide. Rome, FAO. https://doi.org/10.4060/cc5371en",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Food Composition Table & Databases: Standardisation</span>"
    ]
  },
  {
    "objectID": "fct_harmonisation.html#introduction",
    "href": "fct_harmonisation.html#introduction",
    "title": "9  Food composition harmonisation and food matching",
    "section": "",
    "text": "9.1.1 Food matching\nAfter the FCTs are standardised and harmonised and the food list (i.e., food reported as consumed in the Integrated Household Survey, Wave 5, 2019-2020), we can proceed to match them together. To do so, we are using a standardised list of foods that we called “food dictionary”. As depicted in the Figure 9.1.\n\n\n\n\n\n\nFigure 9.1",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Food composition harmonisation and food matching</span>"
    ]
  },
  {
    "objectID": "fct_harmonisation.html#harmonising-the-food-composition-tables",
    "href": "fct_harmonisation.html#harmonising-the-food-composition-tables",
    "title": "9  Food composition harmonisation and food matching",
    "section": "9.2 Harmonising the Food Composition Tables",
    "text": "9.2 Harmonising the Food Composition Tables\nWhen all the FCTs are standardised, we can use them all together, which is particularly useful when food items and/or nutrient values are missing in the main FCT, then a similar food item could be found in another FCT.",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Food composition harmonisation and food matching</span>"
    ]
  },
  {
    "objectID": "fct_harmonisation.html#getting-the-nutrition-tools",
    "href": "fct_harmonisation.html#getting-the-nutrition-tools",
    "title": "9  Food composition harmonisation and food matching",
    "section": "9.3 Getting the Nutrition Tools",
    "text": "9.3 Getting the Nutrition Tools\nNutritionTools is an R package of functions to help with a wide range of calculations and processes that commonly occur when working with nutrition datasets. More information can be found here.\n\nif (!require(\"devtools\")) {\n  install.packages(\"devtools\")\n}\ndevtools::install_github(\"TomCodd/NutritionTools\")\n\n\n9.3.1 Food composition functions\nThere are some useful functions that can be downloaded here, and are currently being checked to be added to the NutritionTool package. Those can be loaded into the R environment by running the functions.R script.\n\n# We also need to import some custom functions in another script:\nsource(here::here(\"functions.R\")) # Loading nutrition functions\n\nThe function source() will run the called script.",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Food composition harmonisation and food matching</span>"
    ]
  },
  {
    "objectID": "fct_harmonisation.html#getting-the-fc-standardarised-dataset",
    "href": "fct_harmonisation.html#getting-the-fc-standardarised-dataset",
    "title": "9  Food composition harmonisation and food matching",
    "section": "9.4 Getting the FC Standardarised dataset",
    "text": "9.4 Getting the FC Standardarised dataset\nDownload the following folders: KE18 & WA19 from this GitHub repository. Eventually, you could download all of them an create a unique FC library.\nEach folder has one script with the FCT id followed by *“_FCT_FAO_Tags”*, and a README file.\n\n# Finding the list of FCTs/FCDBs script in the data folder\n\nlist.files(\"data/\", pattern = \"*_FCT_FAO_Tags\", recursive=FALSE, # so it is not looking into the subfolders\n           full.names=TRUE)\n\nThe next block of code will download and standardise each individual FCT. Then, the FCTs are merged into a common FC library that can be used for food matching.\n\n# Getting the list of FCTs/FCDBs script in the data folder\nsource_fct_name &lt;- list.files(\"data/\", pattern = \"*_FCT_FAO_Tags.R\", recursive=FALSE, # so it is not looking into the subfolders\n           full.names=TRUE)\n\nfor(i in source_fct_name){\n  source(here::here(i))\n}\n\n\n9.4.1 Merging the data\nChecking the FCT we have in our data folder\n\n# finding all the cleaned FCTs/FCDBs from the output folder\nlist.files(\"data/\", pattern = \"*_FCT_FAO_Tags\", recursive=FALSE, # so it is not looking into the subfolders.\n           full.names=TRUE)\n\nNow, we can merge all the FCTs/FCBDs into one file. Note that this is posible because they all have been standardised previously.\n\n# finding all the cleaned FCTs/FCDBs from the output folder\nlist.files(\"data/\", pattern = \"*_FCT_FAO_Tags\", recursive=FALSE, # so it is not taking the fcts in the folder\n           full.names=TRUE)%&gt;% \n  map_df(~read_csv(., col_types = cols(.default = \"c\"), \n                   locale = locale(encoding = \"Latin1\"))) \n\nWe can check that all FCTs that we are expected are there, by using the source_fct variable that is generated within the standardisation scripts, and the number of foods in each one.\n\n#checking that all FCTs are loaded and \n# counting No. of items \n\ndata.df %&gt;%  \n  count(source_fct)",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Food composition harmonisation and food matching</span>"
    ]
  },
  {
    "objectID": "fct_harmonisation.html#food-matching-1",
    "href": "fct_harmonisation.html#food-matching-1",
    "title": "9  Food composition harmonisation and food matching",
    "section": "9.5 Food matching",
    "text": "9.5 Food matching\nFirst, we need the list of unique foods reported as consumed. In HCES dataset, this is frequently presented as set of standard list of foods. We are also interested in knowing the frequency with each food is reported, and hence their impact and importance for subsequent analysis.\n\n# Read, subset and rename the data\nihs5_consumption &lt;-\n    read_dta(here::here(\"data\", \"mwi-ihs5-sample-data\", \"HH_MOD_G1_vMAPS.dta\")) |&gt;\n    select(\n        case_id,\n        HHID,\n        hh_g01,\n        hh_g01_oth,\n        hh_g02,\n        hh_g03a,\n        hh_g03b,\n        hh_g03b_label,\n        hh_g03b_oth,\n        hh_g03c,\n        hh_g03c_1\n    ) %&gt;%\n    rename(\n        consumedYN = hh_g01,\n        food_item = hh_g02,\n        food_item_other = hh_g01_oth,\n        consumption_quantity = hh_g03a,\n        consumption_unit = hh_g03b,\n        consumption_unit_label = hh_g03b_label,\n        consumption_unit_oth = hh_g03b_oth,\n        consumption_subunit_1 = hh_g03c,\n        consumption_subunit_2 = hh_g03c_1\n    )\n\n\n# Getting the food item list\n\nihs5_consumption &lt;- hcesNutR::create_dta_labels(ihs5_consumption)\n\n\n# Getting the food list & frequency of HH\n\nfood_list &lt;- ihs5_consumption %&gt;%\n  count(food_item_code, food_item_name)\n\nThen, we will match those food items with their corresponding food dictionary code(s). There are instances were the matching will be one food reported to many foods in the FCT. For example, wheat flour will be matched to wheat flour refined, and wheat flour wholemeal.\n\n# Food dictionary\ndictionary &lt;- read.csv(\"https://raw.github.com/LuciaSegovia/fct/repro/metadata/MAPS_food-dictionary_v3.0.3.csv\")\n\nThen, the unique food dictionary codes (ID_3) will be used to match the food in the food list to the FCTs.\n\n# Matching \n\nihs5 &lt;- read.csv(here::here(\"data\", \"fct_ihs5_v2.2.csv\"))\n\n\n\n\n\n\n\nActivity:\n\n\n\nThinking about food matches between HCES food list and food composition.\n\nDo you think that the food matches selected represents well what the food reported as consumed in the survey?\nIf not, what other foods would you add/remove/change to?\nFor the foods without matches, can you think of what food items you would use?\nCould you identify any food matches in the Food Composition Library that will be a good match for those foods that have no matches?\nWhat nutrients are important for each of the foods selected?",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Food composition harmonisation and food matching</span>"
    ]
  },
  {
    "objectID": "fct_harmonisation.html#dealing-with-missing-values",
    "href": "fct_harmonisation.html#dealing-with-missing-values",
    "title": "9  Food composition harmonisation and food matching",
    "section": "9.6 Dealing with missing values",
    "text": "9.6 Dealing with missing values\n\n9.6.1 Combining Tagnames to generate variables\n\n\n9.6.2 Re-calculating variables\nSome varibles need to be recalculated, as part of the harmonisation process and also for quality assurance. One case is Energy (kcal/kJ) which is calculated from the proximate: Protein, Fat, available Carbohydrates, Fibre and Alcohol. Hence, we need to make sure that all these variables are reported and are completed. For instance, if there were missing values in Fat content, that the combination of Tagnames have been performed. In addition, if we are using Carbohydrate by difference, then we should re-calculate that variable as well.\n\n# Re-calculate variables:\ndata.df %&gt;% \n  # Calculate available Carbohydrates, by difference\n  CHOAVLDFg_std_creator() %&gt;%  \n  # Calculate Energy (kcal)\n  ENERCKcal_standardised() %&gt;% \n  # calculate Energy (kJ)\n  ENERCKj_standardised() \n\nAnother similar example is Vitamin A (RE/RAE), which is calculated from retinol and the carotenoids (i.e., Beta-carotene equivalents). Similarly, we need to check that those two variables. Note, that beta-carotene eq. is also re-calculated, when possible, from the carotenids and their conversion factors. Hence, first we should check that beta-carotene, alpha-carotene, and beta-crypoxanthin are available.\n\n# Re-calculate variables:\ndata.df %&gt;% \n# Recalculate beta-carotene eq.\n    CARTBEQmcg_std_creator() %&gt;% \n# Recalculate Vitamin A (RAE)\n   VITA_RAEmcg_std_creator() %&gt;%  \n# Recalculate Vitamin A (RE)\n    VITAmcg_std_creator()\n\n\n\n9.6.3 Further Readings\n\n\nGreenfield, Heather, and D. A. T. Southgate. Food Composition Data: Production, Management, and Use. Rome: FAO, 2003.\nFAO/INFOODS (2012). FAO/INFOODS Guidelines for Checking Food Composition Data Prior to the Publication of a User Table/Database-Version 1.0. FAO, Rome’. Accessed 22 January 2022. https://www.fao.org/3/ap810e/ap810e.pdf.",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Food composition harmonisation and food matching</span>"
    ]
  },
  {
    "objectID": "sample_data.html#introduction",
    "href": "sample_data.html#introduction",
    "title": "10  Appendix A: Sample Data",
    "section": "10.1 Introduction",
    "text": "10.1 Introduction\nThe sample data used in this book was generated from the Malawi Intergrated Household Survey Fifth Edition 2018-2019 downloaded from here.\nThe data was generated randomly using the following code:"
  },
  {
    "objectID": "sample_data.html#define-functions-used",
    "href": "sample_data.html#define-functions-used",
    "title": "10  Appendix A: Sample Data",
    "section": "10.2 Define functions used",
    "text": "10.2 Define functions used\n\n10.2.1 Create case_id generation\n\ngenerate_case_ids &lt;- function(n) {\n    start_id &lt;- 201011000001\n    end_id &lt;- start_id + n-1\n    case_ids &lt;- as.character(seq(start_id, end_id, by = 1))\n    return(case_ids)\n}\n\n\n\n10.2.2 Create HHID generation function\n\ngenerate_HHIDs &lt;- function(n) {\n  hhids &lt;- sapply(1:n, function(x) {\n    paste(sample(c(0:9, letters[1:6]), 32, replace = TRUE), collapse = \"\")\n  })\n  return(hhids)\n}",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Appendix A: Sample Data</span>"
    ]
  },
  {
    "objectID": "sample_data.html#set-seed-and-number-of-households-to-generate",
    "href": "sample_data.html#set-seed-and-number-of-households-to-generate",
    "title": "10  Appendix A: Sample Data",
    "section": "10.3 Set seed and number of households to generate",
    "text": "10.3 Set seed and number of households to generate\n\n# Set seed\nset.seed(123)\n# Set number of households to generate\nhouseholds &lt;- 100",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Appendix A: Sample Data</span>"
    ]
  },
  {
    "objectID": "sample_data.html#load-original-data-and-extract-food-and-unit-lists",
    "href": "sample_data.html#load-original-data-and-extract-food-and-unit-lists",
    "title": "10  Appendix A: Sample Data",
    "section": "10.4 Load Original data and extract food and unit lists",
    "text": "10.4 Load Original data and extract food and unit lists\n\n# Import Malawi IHS5 HCES consumption module data\noriginal_data &lt;-\n  haven::read_dta(here::here(\"data-ignore\", \"IHS5\", \"HH_MOD_G1.dta\"))\n\n# Extract \"standard\" food list from the original data\nfood_list &lt;-\n  original_data |&gt; \n  dplyr::select(hh_g02) |&gt; \n  dplyr::distinct()\n\n# Extract \"non-standard\" food lists from the original data\nother_food_list_codes &lt;-\n  original_data |&gt; \n  dplyr::distinct(hh_g02, hh_g01_oth) |&gt; \n  dplyr::filter(hh_g01_oth != \"\") |&gt; \n  dplyr::distinct(hh_g02) |&gt; \n  dplyr::arrange()\nother_food_list_options &lt;-\n  original_data |&gt; \n  dplyr::distinct(hh_g02, hh_g01_oth) |&gt; \n  dplyr::filter(hh_g01_oth != \"\")\n\n# Extract Food unit lists from the original data\nfood_unit_lists &lt;-\n  original_data |&gt; \n  dplyr::distinct(hh_g03b, hh_g03b_label, hh_g03b_oth, hh_g03c, hh_g03c_1)\n\n# Extract the length of Number of foods from the food list\nn_foods &lt;- length(food_list$hh_g02)",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Appendix A: Sample Data</span>"
    ]
  },
  {
    "objectID": "sample_data.html#data-creation",
    "href": "sample_data.html#data-creation",
    "title": "10  Appendix A: Sample Data",
    "section": "10.5 Data creation",
    "text": "10.5 Data creation\n\n10.5.1 Create HHIDs\n\n# Creeate case_ids\ncase_id &lt;- generate_case_ids(households)\n# Generate HHIDs\nhhids &lt;- generate_HHIDs(households)\n\n\n\n10.5.2 Create data\n\nsample_data &lt;- tibble::tibble(\n  case_id = rep(case_id, each = n_foods),\n  HHID = rep(hhids, each = n_foods),\n      hh_g00_1 = 2,\n    hh_g00_2 = 2,\n  food_list |&gt; dplyr::slice(rep(1:dplyr::n(), households)),\n      hh_g01 = sample(\n      original_data$hh_g01,\n      # replace = T,\n      size = households * 142\n    )\n  ) |&gt;\n\n# Add \"other food items\"\n\n  dplyr::rowwise() |&gt;\n  dplyr::mutate(\n    hh_g01_oth = dplyr::case_when(\n      hh_g02 == 414 &\n        hh_g01 == 1 ~ sample(\n          dplyr::filter(other_food_list_options,hh_g02 == 414) |&gt; dplyr::pull(hh_g01_oth),\n          1\n        ),\n      hh_g02 == 515 &\n        hh_g01 == 1  ~ sample(\n          dplyr::filter(other_food_list_options,hh_g02 == 515) |&gt; dplyr::pull(hh_g01_oth),\n          1\n        ),\n      hh_g02 == 117 &\n        hh_g01 == 1  ~ sample(\n          dplyr::filter(other_food_list_options,hh_g02 == 117) |&gt; dplyr::pull(hh_g01_oth),\n          1\n        ),\n      hh_g02 == 830 &\n        hh_g01 == 1  ~ sample(\n          dplyr::filter(other_food_list_options,hh_g02 == 830) |&gt; dplyr::pull(hh_g01_oth),\n          1\n        ),\n      hh_g02 == 310 &\n        hh_g01 == 1  ~ sample(\n          dplyr::filter(other_food_list_options,hh_g02 == 310) |&gt; dplyr::pull(hh_g01_oth),\n          1\n        ),\n      hh_g02 == 412 &\n        hh_g01 == 1  ~ sample(\n          dplyr::filter(other_food_list_options,hh_g02 == 412) |&gt; dplyr::pull(hh_g01_oth),\n          1\n        ),\n      hh_g02 == 610 &\n        hh_g01 == 1  ~ sample(\n         dplyr::filter( other_food_list_options,hh_g02 == 610) |&gt; dplyr::pull(hh_g01_oth),\n          1\n        ),\n      hh_g02 == 916 &\n        hh_g01 == 1  ~ sample(\n          dplyr::filter(other_food_list_options,hh_g02 == 916) |&gt; dplyr::pull(hh_g01_oth),\n          1\n        ),\n      hh_g02 == 209 &\n        hh_g01 == 1  ~ sample(\n          dplyr::filter(other_food_list_options,hh_g02 == 209) |&gt; dplyr::pull(hh_g01_oth),\n          1\n        ),\n      hh_g02 == 709 &\n        hh_g01 == 1  ~ sample(\n          dplyr::filter(other_food_list_options,hh_g02 == 709) |&gt; dplyr::pull(hh_g01_oth),\n          1\n        ),\n      hh_g02 == 818 &\n        hh_g01 == 1  ~ sample(\n           dplyr::filter(other_food_list_options,hh_g02 == 818) |&gt; dplyr::pull(hh_g01_oth),\n          1\n        ),\n      hh_g02 == 804 &\n        hh_g01 == 1  ~ sample(dplyr::filter(other_food_list_options,hh_g02 == 804) |&gt; dplyr::pull(hh_g01_oth),\n          1\n        ),\n      TRUE ~ \"\"\n    )\n  ) |&gt;\n  dplyr::mutate(hh_g03a = dplyr::case_when(hh_g01 == 1 ~ sample(c(1:10, 0.5:10), 1),\n                                           TRUE ~ NA)) |&gt;\n  dplyr::rowwise() |&gt;\n  dplyr::mutate(unit_key = dplyr::case_when(hh_g01 == 1 ~ sample(1:214, 1), TRUE ~\n                                              NA)) |&gt;\n  dplyr::mutate(\n    hh_g03b = food_unit_lists$hh_g03b[unit_key],\n    hh_g03b_label = food_unit_lists$hh_g03b_label[unit_key],\n    hh_g03b_oth = food_unit_lists$hh_g03b_oth[unit_key],\n    hh_g03c = food_unit_lists$hh_g03c[unit_key],\n    hh_g03c_1 = food_unit_lists$hh_g03c_1[unit_key]\n  ) |&gt;\n  dplyr::select(\n    -unit_key,\n    \"case_id\",\n    \"HHID\",\n    \"hh_g00_1\",\n    \"hh_g00_2\",\n    \"hh_g01\",\n    \"hh_g01_oth\",\n    \"hh_g02\",\n    \"hh_g03a\",\n    \"hh_g03b\",\n    \"hh_g03b_label\",\n    \"hh_g03b_oth\",\n    \"hh_g03c\",\n    \"hh_g03c_1\"\n  ) \n\n\n# Add the rest of the columns\nsample_data &lt;- original_data |&gt; dplyr::filter(is.na(case_id)) |&gt; \ndplyr::bind_rows(sample_data)\n\n\n# Attach stata column labels\nfor (i in names(sample_data)){\n  attr(sample_data[[i]], \"label\") &lt;- attr(original_data[[i]], \"label\")\n}\n\n\n# Export sample data as stata file\nhaven::write_dta(sample_data,here::here(\"data\",\"sample_data\",\"MWI-IHSV\",\"HH_MOD_G1_vMAPS.dta\"))\n\n\n\n10.5.3 Create hh_mod_a_filt.dta file\n\nsample_data |&gt; \ndplyr::select(case_id,HHID) |&gt; \ndplyr::distinct() |&gt; \ndplyr::rowwise() |&gt;\ndplyr::mutate(region = sample(1:3,1)) |&gt; \nhaven::write_dta(here::here(\"data\",\"sample_data\",\"MWI-IHSV\",\"hh_mod_a_filt_vMAPS.dta\"))\n\n\n\n10.5.4 Create hh_roster.dta\n\n# Import original roster from IHS5\nihs5_roster &lt;- haven::read_dta(here::here(\"data-ignore\", \"IHS5\", \"HH_MOD_B.dta\"))\n\n# create a dataframe with the case_ids and HHIDs of our sample data\nsample_roster &lt;- sample_data |&gt; dplyr::distinct(case_id,HHID)\n\n# replicate each row a random number of times between 1 and 10 to simulate household members\nn &lt;- sample(1:10, nrow(sample_roster), replace = TRUE)\nsample_roster &lt;- sample_roster[rep(seq_len(nrow(sample_roster)), times = n), ]\n\n# Create other variables\nsample_roster &lt;- sample_roster |&gt; \ndplyr::rowwise() |&gt;\ndplyr::mutate(hh_b03 = sample(ihs5_roster$hh_b03,1),\nhh_b05a = sample(ihs5_roster$hh_b05a,1),\nhh_b05b = dplyr::case_when(hh_b05a &lt; 5~sample(1:11,1),TRUE~NA))\n\n# Add the other blank columns from the original dataset\nsample_roster &lt;- ihs5_roster |&gt;\ndplyr::filter(case_id == \"\") |&gt;\ndplyr::bind_rows(sample_roster)\n\n# Attach stata column labels\nfor (i in names(sample_roster)){\n  attr(sample_roster[[i]], \"label\") &lt;- attr(ihs5_roster[[i]], \"label\")\n}\n\n# writeout the sample_ihs5_roster\nhaven::write_dta(sample_roster,here::here(\"data\",\"sample_data\",\"MWI-IHSV\",\"HH_MOD_B_vMAPS.dta\"))\n\n\n\n10.5.5 Create sample “HH_MOD_D.dta”\n\n# import original data\noriginal_health &lt;- haven::read_dta(here::here(\"data-ignore\", \"IHS5\", \"HH_MOD_D.dta\"))\n\n# Use the sample_roster to create a sample_health dataset\nsample_health &lt;- sample_roster |&gt;\ndplyr::select(case_id,HHID) |&gt;\ndplyr::rowwise()|&gt;\ndplyr::mutate(hh_d05a = sample(c(original_health$hh_d05a),1),\nhh_d05b = sample(original_health$hh_d05b,1))\n\n# Add the other blank columns from the original dataset\nsample_health &lt;- original_health |&gt;\ndplyr::filter(case_id == \"\") |&gt;\ndplyr::bind_rows(sample_health)\n\n# Attach stata column labels\nfor (i in names(sample_health)){\n  attr(sample_health[[i]], \"label\") &lt;- attr(sample_health[[i]], \"label\")\n}\n\n# writeout the sample_ihs5_roster\nhaven::write_dta(sample_health,here::here(\"data\",\"sample_data\",\"MWI-IHSV\",\"HH_MOD_D_vMAPS.dta\"))",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Appendix A: Sample Data</span>"
    ]
  },
  {
    "objectID": "data_visualisation.html#plots-and-graphs",
    "href": "data_visualisation.html#plots-and-graphs",
    "title": "6  Data Visualisation",
    "section": "",
    "text": "Univariate graphs\nMultivariate graphs\nControlling layout\nPrinting graphs",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Data Visualisation</span>"
    ]
  },
  {
    "objectID": "data_visualisation.html#univariate-graphs",
    "href": "data_visualisation.html#univariate-graphs",
    "title": "6  Data Visualisation",
    "section": "6.2 Univariate graphs",
    "text": "6.2 Univariate graphs\nIn this section, we look at graphics that we may create with a single variable. This includes histograms, boxplots, bar charts, as well as QQ plots. These are usually important in checking the distribution of variables in your dataset or checking the residuals of a fitted model.\nFirst we need to create a base for our plot.\n\n# Generating the base for the plot\n\nihs5_consumption %&gt;% \n  ggplot()\n\n\n\n\n\n\n\n\n\n6.2.1 Histogram\n\n# Creating the histogram\n\nihs5_consumption %&gt;% \n  ggplot() +\n  geom_histogram(aes(consumption_per_person))\n\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n\n\n\n\n\n\n\n\n\n\nChanging colour of a histogram\n\n\n\n\n\n\nColour names (click to expand)\n\n\n\n\n\nThis is done by adding argument fill =\"color\". There are various options of colors that can be used. You can check the various options of colors you can use by typing colors().\n\ncolors()\n\n  [1] \"white\"                \"aliceblue\"            \"antiquewhite\"        \n  [4] \"antiquewhite1\"        \"antiquewhite2\"        \"antiquewhite3\"       \n  [7] \"antiquewhite4\"        \"aquamarine\"           \"aquamarine1\"         \n [10] \"aquamarine2\"          \"aquamarine3\"          \"aquamarine4\"         \n [13] \"azure\"                \"azure1\"               \"azure2\"              \n [16] \"azure3\"               \"azure4\"               \"beige\"               \n [19] \"bisque\"               \"bisque1\"              \"bisque2\"             \n [22] \"bisque3\"              \"bisque4\"              \"black\"               \n [25] \"blanchedalmond\"       \"blue\"                 \"blue1\"               \n [28] \"blue2\"                \"blue3\"                \"blue4\"               \n [31] \"blueviolet\"           \"brown\"                \"brown1\"              \n [34] \"brown2\"               \"brown3\"               \"brown4\"              \n [37] \"burlywood\"            \"burlywood1\"           \"burlywood2\"          \n [40] \"burlywood3\"           \"burlywood4\"           \"cadetblue\"           \n [43] \"cadetblue1\"           \"cadetblue2\"           \"cadetblue3\"          \n [46] \"cadetblue4\"           \"chartreuse\"           \"chartreuse1\"         \n [49] \"chartreuse2\"          \"chartreuse3\"          \"chartreuse4\"         \n [52] \"chocolate\"            \"chocolate1\"           \"chocolate2\"          \n [55] \"chocolate3\"           \"chocolate4\"           \"coral\"               \n [58] \"coral1\"               \"coral2\"               \"coral3\"              \n [61] \"coral4\"               \"cornflowerblue\"       \"cornsilk\"            \n [64] \"cornsilk1\"            \"cornsilk2\"            \"cornsilk3\"           \n [67] \"cornsilk4\"            \"cyan\"                 \"cyan1\"               \n [70] \"cyan2\"                \"cyan3\"                \"cyan4\"               \n [73] \"darkblue\"             \"darkcyan\"             \"darkgoldenrod\"       \n [76] \"darkgoldenrod1\"       \"darkgoldenrod2\"       \"darkgoldenrod3\"      \n [79] \"darkgoldenrod4\"       \"darkgray\"             \"darkgreen\"           \n [82] \"darkgrey\"             \"darkkhaki\"            \"darkmagenta\"         \n [85] \"darkolivegreen\"       \"darkolivegreen1\"      \"darkolivegreen2\"     \n [88] \"darkolivegreen3\"      \"darkolivegreen4\"      \"darkorange\"          \n [91] \"darkorange1\"          \"darkorange2\"          \"darkorange3\"         \n [94] \"darkorange4\"          \"darkorchid\"           \"darkorchid1\"         \n [97] \"darkorchid2\"          \"darkorchid3\"          \"darkorchid4\"         \n[100] \"darkred\"              \"darksalmon\"           \"darkseagreen\"        \n[103] \"darkseagreen1\"        \"darkseagreen2\"        \"darkseagreen3\"       \n[106] \"darkseagreen4\"        \"darkslateblue\"        \"darkslategray\"       \n[109] \"darkslategray1\"       \"darkslategray2\"       \"darkslategray3\"      \n[112] \"darkslategray4\"       \"darkslategrey\"        \"darkturquoise\"       \n[115] \"darkviolet\"           \"deeppink\"             \"deeppink1\"           \n[118] \"deeppink2\"            \"deeppink3\"            \"deeppink4\"           \n[121] \"deepskyblue\"          \"deepskyblue1\"         \"deepskyblue2\"        \n[124] \"deepskyblue3\"         \"deepskyblue4\"         \"dimgray\"             \n[127] \"dimgrey\"              \"dodgerblue\"           \"dodgerblue1\"         \n[130] \"dodgerblue2\"          \"dodgerblue3\"          \"dodgerblue4\"         \n[133] \"firebrick\"            \"firebrick1\"           \"firebrick2\"          \n[136] \"firebrick3\"           \"firebrick4\"           \"floralwhite\"         \n[139] \"forestgreen\"          \"gainsboro\"            \"ghostwhite\"          \n[142] \"gold\"                 \"gold1\"                \"gold2\"               \n[145] \"gold3\"                \"gold4\"                \"goldenrod\"           \n[148] \"goldenrod1\"           \"goldenrod2\"           \"goldenrod3\"          \n[151] \"goldenrod4\"           \"gray\"                 \"gray0\"               \n[154] \"gray1\"                \"gray2\"                \"gray3\"               \n[157] \"gray4\"                \"gray5\"                \"gray6\"               \n[160] \"gray7\"                \"gray8\"                \"gray9\"               \n[163] \"gray10\"               \"gray11\"               \"gray12\"              \n[166] \"gray13\"               \"gray14\"               \"gray15\"              \n[169] \"gray16\"               \"gray17\"               \"gray18\"              \n[172] \"gray19\"               \"gray20\"               \"gray21\"              \n[175] \"gray22\"               \"gray23\"               \"gray24\"              \n[178] \"gray25\"               \"gray26\"               \"gray27\"              \n[181] \"gray28\"               \"gray29\"               \"gray30\"              \n[184] \"gray31\"               \"gray32\"               \"gray33\"              \n[187] \"gray34\"               \"gray35\"               \"gray36\"              \n[190] \"gray37\"               \"gray38\"               \"gray39\"              \n[193] \"gray40\"               \"gray41\"               \"gray42\"              \n[196] \"gray43\"               \"gray44\"               \"gray45\"              \n[199] \"gray46\"               \"gray47\"               \"gray48\"              \n[202] \"gray49\"               \"gray50\"               \"gray51\"              \n[205] \"gray52\"               \"gray53\"               \"gray54\"              \n[208] \"gray55\"               \"gray56\"               \"gray57\"              \n[211] \"gray58\"               \"gray59\"               \"gray60\"              \n[214] \"gray61\"               \"gray62\"               \"gray63\"              \n[217] \"gray64\"               \"gray65\"               \"gray66\"              \n[220] \"gray67\"               \"gray68\"               \"gray69\"              \n[223] \"gray70\"               \"gray71\"               \"gray72\"              \n[226] \"gray73\"               \"gray74\"               \"gray75\"              \n[229] \"gray76\"               \"gray77\"               \"gray78\"              \n[232] \"gray79\"               \"gray80\"               \"gray81\"              \n[235] \"gray82\"               \"gray83\"               \"gray84\"              \n[238] \"gray85\"               \"gray86\"               \"gray87\"              \n[241] \"gray88\"               \"gray89\"               \"gray90\"              \n[244] \"gray91\"               \"gray92\"               \"gray93\"              \n[247] \"gray94\"               \"gray95\"               \"gray96\"              \n[250] \"gray97\"               \"gray98\"               \"gray99\"              \n[253] \"gray100\"              \"green\"                \"green1\"              \n[256] \"green2\"               \"green3\"               \"green4\"              \n[259] \"greenyellow\"          \"grey\"                 \"grey0\"               \n[262] \"grey1\"                \"grey2\"                \"grey3\"               \n[265] \"grey4\"                \"grey5\"                \"grey6\"               \n[268] \"grey7\"                \"grey8\"                \"grey9\"               \n[271] \"grey10\"               \"grey11\"               \"grey12\"              \n[274] \"grey13\"               \"grey14\"               \"grey15\"              \n[277] \"grey16\"               \"grey17\"               \"grey18\"              \n[280] \"grey19\"               \"grey20\"               \"grey21\"              \n[283] \"grey22\"               \"grey23\"               \"grey24\"              \n[286] \"grey25\"               \"grey26\"               \"grey27\"              \n[289] \"grey28\"               \"grey29\"               \"grey30\"              \n[292] \"grey31\"               \"grey32\"               \"grey33\"              \n[295] \"grey34\"               \"grey35\"               \"grey36\"              \n[298] \"grey37\"               \"grey38\"               \"grey39\"              \n[301] \"grey40\"               \"grey41\"               \"grey42\"              \n[304] \"grey43\"               \"grey44\"               \"grey45\"              \n[307] \"grey46\"               \"grey47\"               \"grey48\"              \n[310] \"grey49\"               \"grey50\"               \"grey51\"              \n[313] \"grey52\"               \"grey53\"               \"grey54\"              \n[316] \"grey55\"               \"grey56\"               \"grey57\"              \n[319] \"grey58\"               \"grey59\"               \"grey60\"              \n[322] \"grey61\"               \"grey62\"               \"grey63\"              \n[325] \"grey64\"               \"grey65\"               \"grey66\"              \n[328] \"grey67\"               \"grey68\"               \"grey69\"              \n[331] \"grey70\"               \"grey71\"               \"grey72\"              \n[334] \"grey73\"               \"grey74\"               \"grey75\"              \n[337] \"grey76\"               \"grey77\"               \"grey78\"              \n[340] \"grey79\"               \"grey80\"               \"grey81\"              \n[343] \"grey82\"               \"grey83\"               \"grey84\"              \n[346] \"grey85\"               \"grey86\"               \"grey87\"              \n[349] \"grey88\"               \"grey89\"               \"grey90\"              \n[352] \"grey91\"               \"grey92\"               \"grey93\"              \n[355] \"grey94\"               \"grey95\"               \"grey96\"              \n[358] \"grey97\"               \"grey98\"               \"grey99\"              \n[361] \"grey100\"              \"honeydew\"             \"honeydew1\"           \n[364] \"honeydew2\"            \"honeydew3\"            \"honeydew4\"           \n[367] \"hotpink\"              \"hotpink1\"             \"hotpink2\"            \n[370] \"hotpink3\"             \"hotpink4\"             \"indianred\"           \n[373] \"indianred1\"           \"indianred2\"           \"indianred3\"          \n[376] \"indianred4\"           \"ivory\"                \"ivory1\"              \n[379] \"ivory2\"               \"ivory3\"               \"ivory4\"              \n[382] \"khaki\"                \"khaki1\"               \"khaki2\"              \n[385] \"khaki3\"               \"khaki4\"               \"lavender\"            \n[388] \"lavenderblush\"        \"lavenderblush1\"       \"lavenderblush2\"      \n[391] \"lavenderblush3\"       \"lavenderblush4\"       \"lawngreen\"           \n[394] \"lemonchiffon\"         \"lemonchiffon1\"        \"lemonchiffon2\"       \n[397] \"lemonchiffon3\"        \"lemonchiffon4\"        \"lightblue\"           \n[400] \"lightblue1\"           \"lightblue2\"           \"lightblue3\"          \n[403] \"lightblue4\"           \"lightcoral\"           \"lightcyan\"           \n[406] \"lightcyan1\"           \"lightcyan2\"           \"lightcyan3\"          \n[409] \"lightcyan4\"           \"lightgoldenrod\"       \"lightgoldenrod1\"     \n[412] \"lightgoldenrod2\"      \"lightgoldenrod3\"      \"lightgoldenrod4\"     \n[415] \"lightgoldenrodyellow\" \"lightgray\"            \"lightgreen\"          \n[418] \"lightgrey\"            \"lightpink\"            \"lightpink1\"          \n[421] \"lightpink2\"           \"lightpink3\"           \"lightpink4\"          \n[424] \"lightsalmon\"          \"lightsalmon1\"         \"lightsalmon2\"        \n[427] \"lightsalmon3\"         \"lightsalmon4\"         \"lightseagreen\"       \n[430] \"lightskyblue\"         \"lightskyblue1\"        \"lightskyblue2\"       \n[433] \"lightskyblue3\"        \"lightskyblue4\"        \"lightslateblue\"      \n[436] \"lightslategray\"       \"lightslategrey\"       \"lightsteelblue\"      \n[439] \"lightsteelblue1\"      \"lightsteelblue2\"      \"lightsteelblue3\"     \n[442] \"lightsteelblue4\"      \"lightyellow\"          \"lightyellow1\"        \n[445] \"lightyellow2\"         \"lightyellow3\"         \"lightyellow4\"        \n[448] \"limegreen\"            \"linen\"                \"magenta\"             \n[451] \"magenta1\"             \"magenta2\"             \"magenta3\"            \n[454] \"magenta4\"             \"maroon\"               \"maroon1\"             \n[457] \"maroon2\"              \"maroon3\"              \"maroon4\"             \n[460] \"mediumaquamarine\"     \"mediumblue\"           \"mediumorchid\"        \n[463] \"mediumorchid1\"        \"mediumorchid2\"        \"mediumorchid3\"       \n[466] \"mediumorchid4\"        \"mediumpurple\"         \"mediumpurple1\"       \n[469] \"mediumpurple2\"        \"mediumpurple3\"        \"mediumpurple4\"       \n[472] \"mediumseagreen\"       \"mediumslateblue\"      \"mediumspringgreen\"   \n[475] \"mediumturquoise\"      \"mediumvioletred\"      \"midnightblue\"        \n[478] \"mintcream\"            \"mistyrose\"            \"mistyrose1\"          \n[481] \"mistyrose2\"           \"mistyrose3\"           \"mistyrose4\"          \n[484] \"moccasin\"             \"navajowhite\"          \"navajowhite1\"        \n[487] \"navajowhite2\"         \"navajowhite3\"         \"navajowhite4\"        \n[490] \"navy\"                 \"navyblue\"             \"oldlace\"             \n[493] \"olivedrab\"            \"olivedrab1\"           \"olivedrab2\"          \n[496] \"olivedrab3\"           \"olivedrab4\"           \"orange\"              \n[499] \"orange1\"              \"orange2\"              \"orange3\"             \n[502] \"orange4\"              \"orangered\"            \"orangered1\"          \n[505] \"orangered2\"           \"orangered3\"           \"orangered4\"          \n[508] \"orchid\"               \"orchid1\"              \"orchid2\"             \n[511] \"orchid3\"              \"orchid4\"              \"palegoldenrod\"       \n[514] \"palegreen\"            \"palegreen1\"           \"palegreen2\"          \n[517] \"palegreen3\"           \"palegreen4\"           \"paleturquoise\"       \n[520] \"paleturquoise1\"       \"paleturquoise2\"       \"paleturquoise3\"      \n[523] \"paleturquoise4\"       \"palevioletred\"        \"palevioletred1\"      \n[526] \"palevioletred2\"       \"palevioletred3\"       \"palevioletred4\"      \n[529] \"papayawhip\"           \"peachpuff\"            \"peachpuff1\"          \n[532] \"peachpuff2\"           \"peachpuff3\"           \"peachpuff4\"          \n[535] \"peru\"                 \"pink\"                 \"pink1\"               \n[538] \"pink2\"                \"pink3\"                \"pink4\"               \n[541] \"plum\"                 \"plum1\"                \"plum2\"               \n[544] \"plum3\"                \"plum4\"                \"powderblue\"          \n[547] \"purple\"               \"purple1\"              \"purple2\"             \n[550] \"purple3\"              \"purple4\"              \"red\"                 \n[553] \"red1\"                 \"red2\"                 \"red3\"                \n[556] \"red4\"                 \"rosybrown\"            \"rosybrown1\"          \n[559] \"rosybrown2\"           \"rosybrown3\"           \"rosybrown4\"          \n[562] \"royalblue\"            \"royalblue1\"           \"royalblue2\"          \n[565] \"royalblue3\"           \"royalblue4\"           \"saddlebrown\"         \n[568] \"salmon\"               \"salmon1\"              \"salmon2\"             \n[571] \"salmon3\"              \"salmon4\"              \"sandybrown\"          \n[574] \"seagreen\"             \"seagreen1\"            \"seagreen2\"           \n[577] \"seagreen3\"            \"seagreen4\"            \"seashell\"            \n[580] \"seashell1\"            \"seashell2\"            \"seashell3\"           \n[583] \"seashell4\"            \"sienna\"               \"sienna1\"             \n[586] \"sienna2\"              \"sienna3\"              \"sienna4\"             \n[589] \"skyblue\"              \"skyblue1\"             \"skyblue2\"            \n[592] \"skyblue3\"             \"skyblue4\"             \"slateblue\"           \n[595] \"slateblue1\"           \"slateblue2\"           \"slateblue3\"          \n[598] \"slateblue4\"           \"slategray\"            \"slategray1\"          \n[601] \"slategray2\"           \"slategray3\"           \"slategray4\"          \n[604] \"slategrey\"            \"snow\"                 \"snow1\"               \n[607] \"snow2\"                \"snow3\"                \"snow4\"               \n[610] \"springgreen\"          \"springgreen1\"         \"springgreen2\"        \n[613] \"springgreen3\"         \"springgreen4\"         \"steelblue\"           \n[616] \"steelblue1\"           \"steelblue2\"           \"steelblue3\"          \n[619] \"steelblue4\"           \"tan\"                  \"tan1\"                \n[622] \"tan2\"                 \"tan3\"                 \"tan4\"                \n[625] \"thistle\"              \"thistle1\"             \"thistle2\"            \n[628] \"thistle3\"             \"thistle4\"             \"tomato\"              \n[631] \"tomato1\"              \"tomato2\"              \"tomato3\"             \n[634] \"tomato4\"              \"turquoise\"            \"turquoise1\"          \n[637] \"turquoise2\"           \"turquoise3\"           \"turquoise4\"          \n[640] \"violet\"               \"violetred\"            \"violetred1\"          \n[643] \"violetred2\"           \"violetred3\"           \"violetred4\"          \n[646] \"wheat\"                \"wheat1\"               \"wheat2\"              \n[649] \"wheat3\"               \"wheat4\"               \"whitesmoke\"          \n[652] \"yellow\"               \"yellow1\"              \"yellow2\"             \n[655] \"yellow3\"              \"yellow4\"              \"yellowgreen\"         \n\n\n\n\n\nThe color name is placed in quotation marks. Let us make our histogram dark blue.\n\n# Changing  colour of the histogram\nihs5_consumption %&gt;% \n  ggplot() +\n  geom_histogram(aes(consumption_per_person), fill = \"darkblue\")\n\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n\n\n\n\n\n\n\n\n\nThis produces a histogram with blue bars, an x-axis labelled \"consumption_per_person\" and no title. All these three can be changed to your preference by adding extra arguments to the ggplot() function.\nFor instance, changing name of x-axis: This is done by adding argument xlab(\"name of axis\"). Note that the name of axis is in quotation marks. Lets assume these data is food consumption data.\n\nihs5_consumption %&gt;% \n  ggplot() +\n  geom_histogram(aes(consumption_per_person), fill = \"darkblue\") + \n  xlab(\"food consumption per person (g/day)\") \n\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nTip\n\n\n\nNote that in some published graphs you will find a \"solidus\" or / inbetween the name of the variable and the units. This is good practice for presenting units in axis labels, favoured by many publishers. The quantities on some axis labels have dimensions which are ratios, like gram per day. This can be done \"g/day\" but that is not good scientific practice, particularly if you are using the solidus to indicate units as above. It is better to follow the \"g\" with a power \"-1\". In R we can do this as follows (of course your data won’t be realistic for this example!)\n\n\n\n# Using expession for labelling units in x-axis\nihs5_consumption %&gt;% \n  ggplot() +\n  geom_histogram(aes(consumption_per_person), fill = \"darkblue\") + \n  xlab(expression(\"g day\"^-1))\n\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n\n\n\n\n\n\n\n\n\n\n\nChanging main title\nThis is done by adding argument ggtitle(\"name of main title\"). Note that the name of axis is in quotation marks. Lets assume these data is food consumption per person data.\n\n# Adding the title\nihs5_consumption %&gt;% \n  ggplot() +\n  geom_histogram(aes(consumption_per_person), fill = \"darkblue\") + \n  xlab(expression(\"g day\"^-1)) +\n  ggtitle(\"Histogram of food consumption per person\") \n\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n\n\n\n\n\n\n\n\n\nYou can also change other features like the contour of the bins or the width.\n\n# Changing bin width of the histogram\nihs5_consumption %&gt;% \n  ggplot() +\n  geom_histogram(aes(consumption_per_person), binwidth = 0.5) +  \n  xlab(expression(\"g day\"^-1)) +\n  ggtitle(\"Histogram of food consumption per person\") \n\n\n\n\n\n\n\n# Changing outline colour of the histogram\nihs5_consumption %&gt;% \n  ggplot() +\n  geom_histogram(aes(consumption_per_person), colour = \"green\") +  \n  xlab(expression(\"g day\"^-1)) +\n  ggtitle(\"Histogram of food consumption per person\") \n\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nExercise\n\n\n\n\ngenerate a red histogram. Label the histogram appropriately, assuming that these are data for Food consumption per household in kilograms per week.\n\n\n\n\n\n\n6.2.2 QQ plots\nThe second type of plot we can look at is the QQ plot. This plot is used to check normality of data. The argument used is stat_qq(), and it needs to specify the sample=variable.\n\n# QQ plot\nihs5_consumption %&gt;% \n  # This generates the empty plot...\n  ggplot() +\n  # Here info on the type of plot and the variable \n    stat_qq(aes(sample = consumption_per_person))\n\n\n\n\n\n\n\n\nThe argument for this function is the food consumption per person. The sample quantiles are just the data values, plotted in increasing order.\nThe theoretical quantiles are the corresponding values for an ordered set of the same number of variables with the standard normal distribution (mean zero variance 1). This means that, if the data are normal, the QQ plot should lie on a straight line. The stat_qq_line() command adds this line to the plot to help your interpretation.\n\n# QQ plot + QQ line\nihs5_consumption %&gt;% \n  ggplot() +\n  stat_qq(aes(sample = consumption_per_person)) +\n  stat_qq_line(aes(sample = consumption_per_person))\n\n\n\n\n\n\n\n\nYou can add a plot title using ggtitle(\"\") as in “histogram and you can change the stat_qq_line() color if you so wish by adding the colour=\"\" argument.\n\n# QQ plot + QQ line (in red)\nihs5_consumption %&gt;% \n  ggplot() +\n  stat_qq(aes(sample = consumption_per_person)) +\n  stat_qq_line(aes(sample = consumption_per_person), colour = \"red\") +\n  ggtitle(\"Food consumption QQ-plot\")\n\n\n\n\n\n\n\n\nNow, let’s see how it is seen when a normal distrubutied variable is plotted with this type of graphs…\n\n# Normally distributed dataset\nx &lt;- rnorm(nrow(ihs5_consumption))\n\n# Normal QQ plot + QQ line (in red)\nihs5_consumption %&gt;% \n  ggplot() +\n  stat_qq(aes(sample = x)) +\n  stat_qq_line(aes(sample = x), colour = \"red\") +\n  ggtitle(\"Normal QQ-plot\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nExercise: qq plot\n\n\n\n\ngenerate a qq plot with a 1:1 line.\nLabel it appropriately assuming that these are data for Food consumption per household in kilograms per week.\n\n\n\n\n\n6.2.3 Box plot\nBox plots give summary of the minimum, first quartile, median, third quartile inter quartile range, maximum and outlier values in your dataset.\nThey are used for univariate data but can be split based on a factorial variable e.g gender or region. The function that is used to call for a boxplot is geom_boxplot() and the argument is vector data. Let us try plotting using the data we generated earlier.\n\n# Boxplot\nihs5_consumption %&gt;% \n  ggplot() +\n  geom_boxplot(aes(consumption_per_person))\n\n\n\n\n\n\n\n\nLet’s try a different orientation…\n\n# Boxplot - changing the orientation\n\nihs5_consumption %&gt;% \n  ggplot() +\n  geom_boxplot(aes(consumption_per_person)) +\n  # Change the orientation of the graph\n  coord_flip() \n\n\n\n\n\n\n\n\nThe thick black line in the centre of the boxplot corresponds to the median value of the data (half the values are smaller, half are larger). The bottom of the box is the first quartile of the data, Q1 (25% of the values are smaller), and the top of the box is the third quartile of the data, Q3 (25% of the values are larger). This plot provides good information about the distribution of the data.\nIn exploratory data analysis we call the quantity H = Q3-Q1 the “h-spread”. R calculates what are known as “inner fences” of the data which are at Q1-1.5*H and Q3+1.5*H. The “whiskers” above and below the box join the Q1 to the smallest data value inside the inner fences, and Q3 to the largest value inside the inner fences. If there are values outside the inner fences then these appear as points on the plot (outliers).\nYou can choose to label your boxplot with main title, color and label the axis similar to what we did for histograms. This time however, we label y-axis using ylab() argument.\n\n#Boxplot - changing the orientation\n\nihs5_consumption %&gt;% \n  ggplot() +\n  geom_boxplot(aes(consumption_per_person), colour = \"dark blue\") +\n  coord_flip() +\n  ylab(\"Food consumption (g/day)\") +\n  ggtitle(\"Boxplot of food consumption per person\") \n\n\n\n\n\n\n\n\nIt is possible to produce a graph in which separate boxplots are produced for different levels of a factor. As an example, we would like to understand how food is consumed in the three regions in the country. The values are stored in the variable called region.\nWe then want to plot our data split by the corresponding region we have sampled. We use the function geom_boxplot() but this time we add a new variable.\n\n#Boxplot - by region\n\n ihs5_consumption %&gt;% \n  ggplot() +\n  geom_boxplot(aes(consumption_per_person, region))\n\n\n\n\n\n\n\n\nNow, we can delete the x-axis label using the xlab(), label the y-axis and change the title to reflect the new variable.\n\n# Boxplot - by region \n\n ihs5_consumption %&gt;% \n  ggplot() +\n  geom_boxplot(aes(consumption_per_person, region), colour = \"dark blue\") +\n  coord_flip() +\n  xlab(\"\") +\n  ylab(\"Food consumption (g/day)\") +\n  ggtitle(\"Boxplot of food consumption per person per region\") \n\nWe can also reorder the boxplots from the lower to the higher median values.\n\n# Boxplot - by region \n\n ihs5_consumption %&gt;% \n  ggplot() +\n  geom_boxplot(aes(x=reorder(region, consumption_per_person), y = consumption_per_person), colour = \"dark blue\") +\n  xlab(\"\") +\n  ylab(\"Food consumption (g/day)\") +\n  ggtitle(\"Boxplot of food consumption per person per region\") \n\n\n\n\n\n\n\nExercise: Box plot\n\n\n\nUsing the data create:\n\nthree boxplots one for each the regions and\nexclude the label in the x-axis,\nlabel the boxplots appropriately.\nare there any outliers in your data?\n\n\n\n\n\n6.2.4 Bar plot\nIn the bar chart, the heights of the bars are based on the values given by the vector input, in this case it count. The argument that is used to call for a barplot is geom_bar() and the argument is our region data.\nThis function usually works well when you have tabular data. The simplest form for the function geom_bar() is given below.\n\n#Bar plot\n  ihs5_consumption %&gt;% \n  ggplot() +\n  geom_bar(aes(region))\n\n\n\n\n\n\n\n# Checking the results of the barplot\ntable(ihs5_consumption$region)\n\n\n  1   2   3 \n805 469 438 \n\n\nYou can check the results by using the function table(), which provide you a count per each variable.\nThere are additional options for giving names to each of the bars, for instance using labels=, and for coloring the bars, as you have seen for other earlier plots.\n\n  ihs5_consumption %&gt;% \n  ggplot() +\n  geom_bar(aes(region)) +\n  # Changing the label of the variable\n  scale_x_discrete(labels =c(`1` = \"Northern\", `2` = \"Central\", `3` = \"Southern\")) +\n  xlab(\"Regions\") +\n  ylab(\"count\") +\n  ggtitle(\"Number of foods reported per region\") \n\n\n\n\n\n\n\n\nYou can also change the axis, by using the ylim() function\n\n# Changing limits and colour\n  ihs5_consumption %&gt;% \n  ggplot() +\n  geom_bar(aes(region),  fill = \"light blue\") +\n    # Changing the label of the variable\n  scale_x_discrete(labels =c(`1` = \"Northern\", `2` = \"Central\", `3` = \"Southern\")) +\n  ylim(0,810) +\n   xlab(\"Regions\") +\n  ylab(\"count\") +\n  ggtitle(\"Number of foods reported per region\") \n\n\n\n\n\n\n\n\n\n\n\n\n\n\nQuestion\n\n\n\nWhat would it happen if you change the y-axis limit from (0, 810) to (0, 800)?\n\n\nYou can also change the colour by each site, that will provide a distinct colour for each site.\n\n# Changing limits and colour by region\n  ihs5_consumption %&gt;% \n  ggplot() +\n  geom_bar(aes(region,  fill = region)) +\n    # Changing the label of the variable\n  scale_fill_discrete(labels =c(`1` = \"Northern\", `2` = \"Central\", `3` = \"Southern\")) +\n  ylim(0,810) +\n   xlab(\"Regions\") +\n  ylab(\"count\") +\n  ggtitle(\"Number of foods reported per region\") \n\n\n\n\n\n\n\n\n\n\n\n\n\n\nExercise: Bar plot\n\n\n\n\nCreate a bar plot to show the frequency of the food consumed by region in the sample,\nlabel it and adjust the axis and colour appropriately.",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Data Visualisation</span>"
    ]
  },
  {
    "objectID": "data_visualisation.html#multivariate-graphs",
    "href": "data_visualisation.html#multivariate-graphs",
    "title": "6  Data Visualisation",
    "section": "6.3 Multivariate graphs",
    "text": "6.3 Multivariate graphs\nIn this section, we look at graphics that we may create with multiple variables. They are important in checking how two or more variables relate to each other.\n\n6.3.1 Plots\nThe simplest scatter plot is done using the geom_point() function which takes in two arguments. The first argument represents the x-axis while the second argument is the vector of y-axis.\n\n# The data points per site (x, y)\n  ihs5_consumption %&gt;% \n  ggplot() +\n  geom_point(aes(region, consumption_per_person)) \n\nFrom the scatter plot, you will notice that, by default,it added axis labels that are simply the names of the objects we passed i.e consumption_per_person and region and there is no title. All of these things, can be added as previous graphs.\nThe list below shows arguments that can be added to the plot function as discussed already:\n\nxlab(\"Region\")\nylab(\"Food compsumption (g/day\")\nggtitle(\"Food consumption by different regions in the country\")\n\n\n # The changing the colour of the data points per site (x, y)\nihs5_consumption %&gt;% \n  ggplot() +\n  geom_point(aes(region, consumption_per_person), \n             colour = \"red\") + # Define the colour of the symbols\n  xlab(\"Region\") +\n  ylab(\"Food compsumption (g/day\") +\n  ggtitle(\"Food consumption by different regions in Malawi\")\n\n\n\n\n\n\n\n\n\n\n6.3.2 Plot Symbols\nIn the graphics that we have created so far, we have mostly left the plotting symbol as the default, black, unfilled circle. However, We can change the symbol by using the argument shape.\nYou can change the plotting symbol by assigning a numeric value using = sign. There are two categories of symbols. Those that range from 0 to 20 and from 21 to 25. For the symbols that range from 21 to 25, in addition to being able to set the colour, we can also set the fill. The fill of the shapes is actually set with the argument fill=, but just like with the argument colour=, we can assign any colour value.\n\n # Changing the symbol & colour of the data points per site (x, y)\nihs5_consumption %&gt;% \n  ggplot() +\n  geom_point(aes(region, consumption_per_person),\n             shape = 17,  # Defining the symbol\n             colour = \"red\") + # Defining the colour\n  xlab(\"Region\") +\n  ylab(\"Food compsumption (g/day\") +\n  ggtitle(\"Food consumption by different regions in Malawi\")\n\n\n\n\n\n\n\n\nLet us change the fill color of the symbol by using the fill argument. Remember that only symbol from 21 to 25 allow that that argument.\n\n # Changing the symbol, the outline colour and the fill colour of the data points per site (x, y)\n\nihs5_consumption %&gt;% \n  ggplot() +\n  geom_point(aes(region, consumption_per_person),\n             shape = 23, # Define the shape\n             colour = \"red\",  # Define outline colour\n             fill = \"black\") + # Define fill colour\n  xlab(\"Region\") +\n  ylab(\"Food compsumption (g/day\") +\n  ggtitle(\"Food consumption by different regions in Malawi\")\n\n\n\n\n\n\n\n\nWe can also set the size of the symbols. We do this with the argument size=. This argument is simply a numeric value indicating how bigger(or smaller) than the usual size we want our points.\n\nihs5_consumption %&gt;% \n  ggplot() +\n  geom_point(aes(region, consumption_per_person), \n    # Next arguments change the symbol (point)\n             shape = 23,   # Define the symbol\n             colour = \"red\", # Define the outline colour\n             fill = \"black\",  # Define the fill colour \n             size =3) +      # Define the size\n  xlab(\"Region\") +\n  ylab(\"Food compsumption (g/day\") +\n  ggtitle(\"Food consumption by different regions in Malawi\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nExercise 3.6\n\n\n\n\nUpdate plots with different symbols, fill colors and symbol size. You can use any symbol and fill color of your choice.\n\n\n\n\n\n\n\nTip\n\n\n\nNote: not all symbol types accept changing fill color.\n\n\n\n\n\n\n6.3.3 Plot types\nThe plot we have created so far are scatter plots. We can however, use alternative plot types. These may include line plot, step plot and lines with points among others.\n\n\n\n\n\n\nExercise 3.7\n\n\n\nCreate a plot using the variables consumption_quantity, consumption_per_person.\n\n\n\n\n\n\n\n\nExercise 3.8\n\n\n\nFrom your plot in Exercise 3.7 , update plots to differentiate the household size (hh_members) using symbol type and color, fill colors and symbol size. You can use any symbol and fill color of your choice.\n\n\n\n\n\n\nTip\n\n\n\nNote: not all symbol types accept changing fill color.\n\n\n\n\nFrom the dataframe ihs5_consumption, we can plot the data by the different household size on the same plot using colour=.\n\n# Scatterplot of food consumption per person & hh by hh size\nihs5_consumption %&gt;% \n  ggplot()+\n  geom_point(aes(consumption_quantity, consumption_per_person, \n                 colour=hh_members)) + # Define colour by hh size\n  xlab(\"Food consumption per person (g/day)\") + # Rename x-axis\n  ylab(\"Food consumption per household (g/day)\") + # Rename y-axis\n  # Adding a title\n  ggtitle(\"Variation of the food consumption per person & houehold by different household size\")\n\n\n\n\n\n\n\n\nYou can also change the symbol shape by any variable, for instance, region\n\n# Plotting the food consumption per person & hh by hh size (colour) and region  (shape)\nihs5_consumption %&gt;% \n  ggplot()+\n  geom_point(aes(consumption_quantity, consumption_per_person, \n                 shape=region, # Defining shape by region\n                 colour=hh_members)) + # Define colour by hh size\n  xlab(\"Food consumption per person (g/day)\") + # Rename x-axis\n  ylab(\"Food consumption per household (g/day)\") + # Rename y-axis\n  # Adding a title\n  ggtitle(\"Variation of the food consumption per person & household by different household size & region\")\n\n\n\n\n\n\n\n\n\n\n6.3.4 Adding Legend to plot\nAdding a legend to your plot will make your plot easy to translate. From the plot in the previous section, it is not clear what the different colors or shapes represent. A legend provides information for this.The function to use is theme() combined with legend.position().\nThe first argument to this function is the position of the legend on your plot. This can be done either by using X and Y co-ordinate location or a single string of the form \"bottom\", \"top\", \"left\", \"topleft\" among others.\nWe then need to specify the legend text using legend.text argument. This is a vector of text that will be used to label the legend. The order of the text in the vector should correspond to the order of the points in the plot.\nWe then specify colors, points, and so on, for data added maintaining the ordering.\nLets create the legend for the plot of soil moisture vs temperature at the sites liempe, chitedze and domboshava. Note that a plot must already be active for legend to be used.\n\n# Plotting the food consumption per person & hh by hh size (colour) and region  (shape)\n# Changing the position of the legend\nihs5_consumption %&gt;% \n  ggplot()+\n  geom_point(aes(consumption_quantity, consumption_per_person, \n                 shape=region, # Defining shape by region\n                 colour=hh_members)) + # Define colour by hh size\n  xlab(\"Food consumption per person (g/day)\") + # Rename x-axis\n  ylab(\"Food consumption per household (g/day)\") + # Rename y-axis\n  # Adding a title\n  ggtitle(\"Variation of the food consumption per person & household by different household size & region\")+\n   theme(legend.position = \"bottom\") # Changing the position of the legend\n\n\n\n\n\n\n\n\nOne can alternatively use the x,y position on the plot to position the legend\n\n# Plotting the food consumption per person & hh by hh size (colour) and region  (shape)\n# Specifying the location of the legend\nihs5_consumption %&gt;% \n  ggplot()+\n  geom_point(aes(consumption_quantity, consumption_per_person, \n                 shape=region, # Defining shape by region\n                 colour=hh_members)) + # Define colour by hh size\n  xlab(\"Food consumption per person (g/day)\") + # Rename x-axis\n  ylab(\"Food consumption per household (g/day)\") + # Rename y-axis\n  # Adding a title\n  ggtitle(\"Variation of the food consumption per person & household by different household size & region\")+\n  # Specifying the position of the legend\n  theme(legend.position = c(.1, .6)) \n\nWarning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2\n3.5.0.\nℹ Please use the `legend.position.inside` argument of `theme()` instead.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nExercise 3.9\n\n\n\nFrom your previous plot in exercise 3.8, add a legend to the updated plot that differentiate the region using symbol type and color, fill colors and symbol size.\n\n\n\n\n6.3.5 Controlling graphical layout\nWhen we create plots, we may want to present them on the same page for easy comparison. This can be done in two ways, firstly, using the facetting (e.g., facet_wrap()) or using the plot_grid() function.\n\nUsing facet function\nThere are two facet_ functions within the ggplot. The first one facet_wrap is commonly used when you only need to visualise your data based on one categorical variable. It only needs to specify the variable (vars()) by which one you want to separate your data by. When you have more than one categorical variables that you want to split you daya by, the function facet_grid() would allow more flexibility.\n\n# Plotting the food consumption per person & hh by region\nihs5_consumption %&gt;% \n  ggplot()+\n  geom_point(aes(consumption_quantity, consumption_per_person)) +\n  # Adding the variable for splitting the data\n   facet_wrap(vars(region)) +\n  xlab(\"Food consumption per person (g/day)\") + # Rename x-axis\n  ylab(\"Food consumption per household (g/day)\") + # Rename y-axis\n  # Adding a title\n  ggtitle(\"Variation of the food consumption per person & household by different household size & region\") \n\n\n\n\n\n\n\n\n\n\nUsing plot_grid() function\nThis function is not part of the ggplot2 package, therefore it has to be installed and loaded before using it (For more information about packages see Section 4.2.\n\n# Installing the package for the first time\n# instal.package(\"cowplot\")\n\n# Loading the library\nlibrary(cowplot)\n\nWith thhe plot_grid we can set up a graphics using the nrow argument. The argument is a vector of the number of rows and columns into which our device should be split. When we then create and store the graphics, they will be entered into the device across the rows, starting in the top left of the grid.\nAs an example, let’s use some of the graphs that we have been creating, and plote them together.\nFirst, we are going to plot and save the scatter plot with the faceted region as an object in our environment called graph1.\n\n\n\n\n\n\nTip\n\n\n\nNote: If you place parenthesis () around your code when saving the object the object will be printed.\n\n\n\n# Saving the graph1: Food consumption per person & hh by region\n\ngraph1 &lt;- ihs5_consumption %&gt;% \n  ggplot()+\n  geom_point(aes(consumption_quantity, consumption_per_person)) +\n  # Adding the variable for splitting the data\n   facet_wrap(vars(region)) +\n  xlab(\"Food consumption per person (g/day)\") + # Rename x-axis\n  ylab(\"Food consumption per household (g/day)\") + # Rename y-axis\n  # Adding a title\n  ggtitle(\"Variation of the food consumption per person & household by different household size & region\")\n\ngraph1\n\nThen, let’s do the same for the box plot and the histogram.\n\n# Saving the graph2: Food consumption per person by region\n (graph2 &lt;- ihs5_consumption %&gt;% \n  ggplot() +\n  geom_boxplot(aes(consumption_per_person, region), colour = \"dark blue\") +\n  coord_flip() +\n  xlab(\"\") +\n  ylab(\"Food consumption (g/day)\") +\n  ggtitle(\"Boxplot of food consumption per person per region\"))\n\n\n\n\n\n\n\n# Saving the graph3: Food consumption per person histogram\n(graph3 &lt;- ihs5_consumption %&gt;% \n  ggplot() +\n  geom_histogram(aes(consumption_per_person), fill = \"darkblue\") + \n  xlab(expression(\"g day\"^-1)) +\n  ggtitle(\"Histogram of food consumption per person\")) \n\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n\n\n\n\n\n\n\n\n\nOnce we have our graphs (objects), let’s plot them together into two rows. We can see that it fills the first row, with the graph1 and graph2, and then the second row with the graph3\n\n# Plotting the three graph together\ncowplot::plot_grid(graph1, graph2, graph3, nrow = 2)\n\nThen, we can add labels to each plot by using the function label=. If we use the \"AUTO\". It will automatically label them from A-Z in the order as they appeard. We can change it to cou\n\n# Plotting the three graph together with label\nplot_grid(graph1, graph2, graph3, nrow = 2, labels = \"AUTO\")\n\nWe can customise the labels by changing the label function.\n\n# Plotting the three graph together\ncowplot::plot_grid(graph1, graph2, graph3, nrow = 2, \n          labels = c(\"1)\", \"2)\", \"3)\"))\n\nWe can also change the way it is structure, by plotting two graphs as it was one. Let’s save the two first graphs as one combined graph.\n\n(top_row &lt;- cowplot::plot_grid(graph2, graph3, ncol = 2, labels = \"AUTO\"))\n\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n\n\n\n\n\n\n\n\n\nThen, we can plot the again using the top_row object.\n\n# Re-arragning the plots\ncowplot::plot_grid(top_row, graph1, nrow = 2, labels = c(\"\", \"C\"))\n\nWe can see now that there are two plots are now in the first row (there are considered one graph), and the graph at the bottom (graph1) is spread across the second row.\nIn addition, we can change the space that each graph is occupying. For instance, we would like to decrease the size of the histogram and the boxplot (top_row). Note that as it is one graph you can not change the size of the histogram or the boxplot indepdently here.\n\ncowplot::plot_grid(top_row, graph1, nrow = 2, labels = c(\"\", \"C\"), \n          rel_heights = c(0.7, 1, 1))\n\n\n\n\n\n\n\nExercise 3.11\n\n\n\nAdjust, the plot in the previous exercise so that histogram occupies the whole bottom of the plot area and the other three occupy the top of the plot area in equal dimensions.\n\n\n\n\n\n6.3.6 Saving/Printing plots\nNow that we have known how to create graphics, one thing remaining is to save the output.\nThe easiest way is to print the graph you want to save, and then save it using the function in ggsave().\n\n# Printing the graph\nprint(graph2)\n\n#Saving into a pdf\nggsave(\"graph2.pdf\")\n\nThe funtion also allow for defining the height and width.\n\n# Printing the graph\nprint(graph2)\n\n#Saving into a pdf\nggsave(\"graph2.pdf\",  width = 4, height = 4)\n\nIn addition, another option is to print into a new tab, and then save it.\nA number of graphics devices are available, including PDF, PNG, JPEG, and bitmap. If we do not specify the device to use, the default device will be opened, and in R this is the Plot tab.\nTo print a graph to pdf ,png and jpeg, one must create the device before plotting the graph. This is done by using the functions\n\npdf(\"name.pdf\")\npng(\"name.pgn\")\njpeg(\"name.jpeg\") \n\nThe argument for these functions is the desired name of the document in quotation marks e.g. pdf(\"myFirstGraphic.pdf\"). When this function is run, the plot tab in R will not appear but a pdf of the graph will be produced in the working directory.\nLet us create a histogram of 100 random numbers and save it as a pdf document.\n\n# Create a pdf device\npdf(\"myFirstGraphic.pdf\")\n\n# Create a histogram of 100 random numbers\nhist(rnorm(100))\n\n# Close the device\ndev.off() \n\nRemember to close the device when done using the dev.off() function, otherwise all your graphics onward will be pdf documents and not any other device e.g the R plot tab.\n\n\n\n\n\n\nExercise 3.12\n\n\n\nPrint the plot you generated in EXERCISE to a PDF, PNG and JPEG giving it an appropriate name. Remember to close the device.",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Data Visualisation</span>"
    ]
  },
  {
    "objectID": "data_visualisation.html",
    "href": "data_visualisation.html",
    "title": "6  Data Visualisation",
    "section": "",
    "text": "6.1 Plots and Graphs\nThe objective of this section is to provide information on the topic under consideration, along with examples and exercises.\nYou should be able to work through it in R studio. This section requires some packages to be loaded.\nAs the rest of this book and following the the principles of the tydiverse, we use ggplot2 for data visualisation.\n# Loading libraries\n\nlibrary(ggplot2) # data visualisation\nlibrary(dplyr) # data manipulation\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\nTo demonstrate the visuals, let us load a dataframe called ihs5_consumption which was generated in {Chapter 5}.\n# Loading the data\n\nihs5_consumption &lt;- read.csv(here::here(\"data\", \"ihs5_consumption.csv\")) %&gt;% \n  mutate(region = as.factor(region))\n\n# Checking the data\nstr(ihs5_consumption)\n\n'data.frame':   1712 obs. of  36 variables:\n $ case_id               : num  2.01e+11 2.01e+11 2.01e+11 2.01e+11 2.01e+11 ...\n $ HHID                  : chr  \"ee2d2915a43d589af42a8b88c279698d\" \"ee2d2915a43d589af42a8b88c279698d\" \"ee2d2915a43d589af42a8b88c279698d\" \"ee2d2915a43d589af42a8b88c279698d\" ...\n $ hh_g00_1              : int  2 2 2 2 2 2 2 2 2 2 ...\n $ hh_g00_2              : int  2 2 2 2 2 2 2 2 2 2 ...\n $ consumedYN            : int  1 1 1 1 1 1 1 1 1 1 ...\n $ food_item_other       : chr  \"\" \"\" \"\" \"\" ...\n $ food_item             : int  104 208 301 307 311 403 515 602 604 701 ...\n $ consumption_quantity  : num  1 8 2.5 6 7.5 7.5 5.5 9 2.5 3.5 ...\n $ consumption_unit      : chr  \"59\" \"23\" \"23\" \"23\" ...\n $ consumption_unit_label: int  59 23 23 23 23 23 23 9 23 23 ...\n $ consumption_unit_oth  : chr  \"\" \"MEDIUM PACKET\" \"TBE\" \"SMALL TINA FLAT\" ...\n $ consumption_subunit_1 : int  NA NA NA NA NA NA NA 2 NA NA ...\n $ consumption_subunit_2 : int  NA NA NA NA NA NA NA NA NA NA ...\n $ hh_g04a               : logi  NA NA NA NA NA NA ...\n $ hh_g04b               : logi  NA NA NA NA NA NA ...\n $ hh_g04b_label         : logi  NA NA NA NA NA NA ...\n $ hh_g04b_oth           : logi  NA NA NA NA NA NA ...\n $ hh_g04c               : logi  NA NA NA NA NA NA ...\n $ hh_g04c_1             : logi  NA NA NA NA NA NA ...\n $ hh_g05                : logi  NA NA NA NA NA NA ...\n $ hh_g06a               : logi  NA NA NA NA NA NA ...\n $ hh_g06b               : logi  NA NA NA NA NA NA ...\n $ hh_g06b_label         : logi  NA NA NA NA NA NA ...\n $ hh_g06b_oth           : logi  NA NA NA NA NA NA ...\n $ hh_g06c               : logi  NA NA NA NA NA NA ...\n $ hh_g06c_1             : logi  NA NA NA NA NA NA ...\n $ hh_g07a               : logi  NA NA NA NA NA NA ...\n $ hh_g07b               : logi  NA NA NA NA NA NA ...\n $ hh_g07b_label         : logi  NA NA NA NA NA NA ...\n $ hh_g07b_oth           : logi  NA NA NA NA NA NA ...\n $ hh_g07c               : logi  NA NA NA NA NA NA ...\n $ hh_g07c_1             : logi  NA NA NA NA NA NA ...\n $ food_item_code        : int  104 208 301 307 311 403 515 602 604 701 ...\n $ hh_members            : int  2 8 4 9 6 8 8 7 4 9 ...\n $ consumption_per_person: num  0.5 1 0.625 0.667 1.25 ...\n $ region                : Factor w/ 3 levels \"1\",\"2\",\"3\": 3 3 3 3 3 3 3 3 3 3 ...\nThis dataframe contains 36 variables, of which we will be focusing on food_item, consumption_per_person, and region.\nThe specific objective of the material in this script is to introduce you to different graphic used in R. By the end you should have a better understanding of some basic concepts regarding data visualisation, and should be better-placed to start developing and editing scripts yourself. The particular topics we shall cover are:",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Data Visualisation</span>"
    ]
  },
  {
    "objectID": "data_visualisation.html#resources",
    "href": "data_visualisation.html#resources",
    "title": "6  Data Visualisation",
    "section": "6.4 Resources",
    "text": "6.4 Resources\nHere’s some website with more information, ideas and code for awesome graphs!\n\nIntro to gglot2\nGglot2 book\nR Graph Gallery",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Data Visualisation</span>"
    ]
  },
  {
    "objectID": "data_wrangling_and_io.html",
    "href": "data_wrangling_and_io.html",
    "title": "5  Data I/O and Wrangling",
    "section": "",
    "text": "5.1 Data Input/Import\nUp to this point we were creating data to manipulate in R. In this section we will learn how to import data into R, manipulate it and export it. We will use the readr and haven packages to import data into R, the dplyr package to manipulate data and the readr package to export data from R. We will also use the here package to manage file paths.\nThere are many ways to import data into R. In this section we will look at how to import data from a CSV file, an Excel file and Stata file. In the sample data folder there are *.csv files and stata files *.dta. Foe example to import the health data from a survey stored in hh_mod_a_filt_vMAPS.dta stored in the mwi-ihs5-sample-data folder within our working directory we run:\n# Load the haven package\nlibrary(haven)\n\n# Import roster data\nihs5_roster &lt;- read_dta(here::here(\"data\",\"mwi-ihs5-sample-data\", \"hh_mod_a_filt_vMAPS.dta\"))\n\n# Preview the data\nhead(ihs5_roster )\nTo read a csv file we use the read_csv() function from the readr package. For example, to import the IHS5_UNIT_CONVERSION_FACTORS_vMAPS.csv file stored in the mwi-ihs5-sample-data folder within our working directory we run:\n# Load the readr package\nlibrary(readr)\n\n# Import unit conversion factors data\nihs5_unit_conversion_factors &lt;- read_csv(here::here(\"data\",\"mwi-ihs5-sample-data\", \"IHS5_UNIT_CONVERSION_FACTORS_vMAPS.csv\"))\n\n# Preview the data\nhead(ihs5_unit_conversion_factors)\nAfter importing files they are usually stored in memory as dataframes/tibbles. We can check the class of an object using the class() function. For example, to check the class of the ihs5_roster object, we would type class(ihs5_roster). We can also check the structure of an object using the str() function. For example, to check the structure of the ihs5_roster object, we would type str(ihs5_roster). We want to make sure that the data is imported correctly before we start manipulating it.",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Data I/O and Wrangling</span>"
    ]
  },
  {
    "objectID": "data_wrangling_and_io.html#data-inputimport",
    "href": "data_wrangling_and_io.html#data-inputimport",
    "title": "5  Data I/O and Wrangling",
    "section": "",
    "text": "Excercise\n\n\n\n\nImport your own excel file into R.\n\n\n\n\n\n\n\n\n\nTip\n\n\n\nNotice how all import operations are done within the here::here() function. This is because we are using the here package to manage file paths. The here::here() function returns the path to the file relative to the working directory. This is useful when you want to share your code with others, as they can run the code without having to change the file paths.\nIt is very import that file names and directories are typed as they are. R is sensitive to capital letters and spaces. For example, if you type IHS5_UNIT_CONVERSION_FACTORS_VMAPS.csv instead of IHS5_UNIT_CONVERSION_FACTORS_vMAPS.csv, R will throw an error. To get around this in RStudio use the tab key to autocomplete file names and directories.",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Data I/O and Wrangling</span>"
    ]
  },
  {
    "objectID": "data_wrangling_and_io.html#data-wrangling",
    "href": "data_wrangling_and_io.html#data-wrangling",
    "title": "5  Data I/O and Wrangling",
    "section": "5.2 Data Wrangling",
    "text": "5.2 Data Wrangling\nThe dplyr package from the tidyverse package is our data wrangling tool of choice. It provides a set of functions for manipulating dataframes e.g. renaming columns, conditional removal of rows, creation of other columns and so on. We will load and manipulate the consumption module of our hypothetical Malawi IHS5 survey data. The data is stored in the mwi-ihs5-sample-data folder within our working directory and is called HH_MOD_G1_vMAPS.dta. We will use the here package to manage file paths.\n\nlibrary(dplyr) # data manipulation\nlibrary(haven) # data import\nlibrary(here) # file paths\n\n\n5.2.1 Import the data\n\n# Import the data\nihs5_consumption &lt;- read_dta(here::here(\"data\",\"mwi-ihs5-sample-data\", \"HH_MOD_G1_vMAPS.dta\"))\n\n\n\n\n\n\n\nExcercise\n\n\n\n\nCheck if the data improrted correctly\nCheck the structure of the data\nHow many observations and variables are there?\n\n\n\n\n\n5.2.2 Subsetting data\n\n\n5.2.3 Subsetting data frames\nThere are a number of functions that can be used to extract subsets of R objects in tidyverse syntax. The most important are the following from the dplyr package:\n\nfilter() allows you to select a subset of rows in a data frame.\nselect() allows you to select a subset of columns in a data frame.\narrange() allows you to reorder the rows of a data frame.\nmutate() allows you to create new columns from existing columns.\nsummarise() allows you to collapse many values down to a single summary.\npull() allows you to extract a single column from a data frame as a vector.\n\n\n\n5.2.4 Subsetting columns\nThis data that we loaded is a randomly generated immitation of the Malawi Intergrated Household Survey 2018-2019 described here. This data contains responses on total consumption as well as disaggregation of the sources of these foods.In this book we will process only the `total consumption.\nRemember we said that our data is loaded in memory? Seeing that the ihs5_consumption data contains columns we do not need let us subset it. The select function in dplyr is very useful for this. For example to keep only the columns with household identifiers and food names, units and quantity of consumption we keep the following columns in our data; “case_id”, “HHID”, “hh_g01”, “hh_g01_oth”, “hh_g02”, “hh_g03a”, “hh_g03b”, “hh_g03b_label”, “hh_g03b_oth”, “hh_g03c”, “hh_g03c_1”.\n\n# Subset the data\nihs5_consumption_subset &lt;-\n    select(\n        ihs5_consumption,\n        case_id,\n        HHID,\n        hh_g01,\n        hh_g01_oth,\n        hh_g02,\n        hh_g03a,\n        hh_g03b,\n        hh_g03b_label,\n        hh_g03b_oth,\n        hh_g03c,\n        hh_g03c_1\n    )\n\nThe syntax for most tidyverse functions is function (data,columns). Notice that we stored the subsetting operation in a new object called ihs5_consumption_subset? This is generally frowned upon unless we intend to use the original dataset for separate operations. Storing the subset in a new object will use up more memory to store the 2 objects. We can overwrite the original object by typing:\n\nihs5_consumption &lt;- select(\n    ihs5_consumption,\n    case_id,\n    HHID,\n    hh_g01,\n    hh_g01_oth,\n    hh_g02,\n    hh_g03a,\n    hh_g03b,\n    hh_g03b_label,\n    hh_g03b_oth,\n    hh_g03c,\n    hh_g03c_1\n)\n\n\n\n\n\n\n\nTip\n\n\n\nInstead of typing the column names, we can use the : operator to select a range of columns. For example, to select all the columns between case_id and hh_g03c_1 we would type:\n\n# Subset the data\nihs5_consumption_subset &lt;-\n    select(\n        ihs5_consumption,\n        case_id:hh_g03c_1\n    )\n\n\n\nNext let us give the columns more meaningful names. We can do this using the rename function. For example, to rename the hh_g01 column to consumedYN and hh_g02 to food_item, we would type:\n\n# Rename the columns\nihs5_consumption &lt;-\n    rename(ihs5_consumption,\n           consumedYN = hh_g01,\n           food_item = hh_g02)\n\nNotice how our operations only affect the specific columns we specify? This is because the select and rename functions are smart and intiutive.\n\n\n\n\n\n\nExcercise\n\n\n\n\nRename the remaining columns to:\n\n\n\n\nold_name\nnew_name\n\n\n\n\nhh_g01_oth\nfood_item_other\n\n\nhh_g03a\nconsumption_quantity\n\n\nhh_g03b\nconsumption_unit\n\n\nhh_g03b_label\nconsumption_unit_label\n\n\nhh_g03b_oth\nconsumption_unit_oth\n\n\nhh_g03c\nconsumption_subunit_1\n\n\nhh_g03c_1\nconsumption_subunit_2\n\n\n\n\n\n\n\n\n\n\n\nTip\n\n\n\n\n\nSolution:\n\n# Reload the data to start from scratch\nihs5_consumption &lt;-\n    read_dta(here::here(\"data\",\n                        \"mwi-ihs5-sample-data\", \n                        \"HH_MOD_G1_vMAPS.dta\"))\n\n# Rename the columns\nihs5_consumption &lt;-\n    rename(\n        ihs5_consumption,\n        consumedYN = hh_g01,\n        food_item = hh_g02,\n        food_item_other = hh_g01_oth,\n        consumption_quantity = hh_g03a,\n        consumption_unit = hh_g03b,\n        consumption_unit_label = hh_g03b_label,\n        consumption_unit_oth = hh_g03b_oth,\n        consumption_subunit_1 = hh_g03c,\n        consumption_subunit_2 = hh_g03c_1\n    )\n\n\n\n\n\n\n5.2.5 Subsetting rows\nWe can also subset rows using the filter function. For example, to keep only the rows where consumedYN is equal to 1, we would type:\n\n# Subset the data\nihs5_consumption &lt;- filter(ihs5_consumption, consumedYN == 1)\n\nNotice how we are using the logical operator == to test each row whether the value of consumedYN is equal to 1? This is called a conditional statement as we discussed in the previous sections.",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Data I/O and Wrangling</span>"
    ]
  },
  {
    "objectID": "data_wrangling_and_io.html#chaining-operations-using-the-pipe-operator",
    "href": "data_wrangling_and_io.html#chaining-operations-using-the-pipe-operator",
    "title": "5  Data I/O and Wrangling",
    "section": "5.3 Chaining operations using the pipe operator",
    "text": "5.3 Chaining operations using the pipe operator\nWe can chain operations using the pipe operator %&gt;% or |&gt;. This is useful when we want to perform multiple operations on a dataset. For example, to read, subset the data and rename the columns in one operation, we would type:\n\n# Read, subset and rename the data\nihs5_consumption &lt;-\n    read_dta(here::here(\"data\",\n                        \"mwi-ihs5-sample-data\", \n                        \"HH_MOD_G1_vMAPS.dta\")) |&gt;\n    select(\n        case_id,\n        HHID,\n        hh_g01,\n        hh_g01_oth,\n        hh_g02,\n        hh_g03a,\n        hh_g03b,\n        hh_g03b_label,\n        hh_g03b_oth,\n        hh_g03c,\n        hh_g03c_1\n    ) %&gt;%\n    rename(\n        consumedYN = hh_g01,\n        food_item = hh_g02,\n        food_item_other = hh_g01_oth,\n        consumption_quantity = hh_g03a,\n        consumption_unit = hh_g03b,\n        consumption_unit_label = hh_g03b_label,\n        consumption_unit_oth = hh_g03b_oth,\n        consumption_subunit_1 = hh_g03c,\n        consumption_subunit_2 = hh_g03c_1\n    )\n\nWe deliberately used both the pipe operators %&gt;% and |&gt; to show that they are the same. The %&gt;% is the most popular of the tidyverse pipes from the magrittr package.\nRecent versions (circa 2020) intoduced the native R pipe |&gt;. The pipe operator is useful when we want to perform multiple operations on a dataset without storing the intermediate results in memory.\nIn the above example we only stored the final result in memory. This is useful when we are working with large datasets and want to save memory.\n\n\n\n\n\n\nPipes\n\n\n\nIn Rstudio you can type the pipe operator by typing Ctlr + shift + m. You can also change whether the pipe operator is %&gt;% or |&gt; in the Tools &gt; Global Options &gt; Code &gt; Editing menu by changing the Use native pipe operator |&gt; (requires R 4.1+) option.\n\n\n\n\n\n\n\n\nWarning\n\n\n\nWhen chaining operations we do not need to specify the data argument in the subsequent functions. This is because the output of the previous function is passed to the next function. If we want to specify the data argument, we can use the . symbol. For example, to specify the data argument in the rename function, we would type:\n\n\n\n5.3.1 Change the data type of a column\nThe mutate function is used to create new columns from existing columns. It is also used to change the data type of a column. For example, to change the data type of the consumption_quantity column to numeric, we would type:\n\nihs5_consumption &lt;- ihs5_consumption |&gt;\n    mutate(food_item_code = as.character(food_item))\n\n\n\n5.3.2 Create a new column\nAs we mentioned earlier, the mutate function is used to create new columns from existing columns. For example, to create a new column with hh_members (randomly generated) we would type:\n\nihs5_consumption &lt;- ihs5_consumption |&gt;\n    mutate(hh_members = sample(1:10, nrow(ihs5_consumption), replace = TRUE))\n\nHere we are using the sample function to generate random numbers between 1 and 10. The nrow function returns the number of rows in the ihs5_consumption data. The replace = TRUE argument tells the sample function to sample with replacement. This means that the same number can be sampled more than once. If we want to sample without replacement we would type replace = FALSE.\nWe used the sample function a lot during the generation of the sample data used in this book. You can see more on this in the data generation section.\n\n\n5.3.3 Vectorised operations\nThe mutate function is also useful for vectorised operations. For example, to create a new column with the consumption per person we would type:\n\nihs5_consumption &lt;- ihs5_consumption |&gt;\n    mutate(consumption_per_person = consumption_quantity / hh_members)\n\n\n\n\n\n\n\nExcercise\n\n\n\nSuppose this data is from a 7 day recall survey. Create a new column with the consumption per person per day.\n\n\n\n\n5.3.4 Enriching data\nWe can enrich our data by joining different files using the join function. The most common joins are left_join, right_join, inner_join and full_join.\nThe left_join function joins two dataframes by keeping all the rows in the first dataframe and matching the rows in the second dataframe.\nMost joining operations in hces data analysis are left_join operations as we want to keep all the rows in the primary data we are processing and enrich it with matched rows in the other data. For example, to join the ihs5_consumption data with the ihs5_household_identifies contained in hh_mod_a_filt_vMAPS.dta data we would type:\n\n# Import the data\nihs5_household_identifiers &lt;-\n    read_dta(here::here(\"data\",\n                        \"mwi-ihs5-sample-data\", \n                        \"hh_mod_a_filt_vMAPS.dta\"))\n\n# Join the data\nihs5_consumption_j1 &lt;- ihs5_consumption |&gt;\n    left_join(ihs5_household_identifiers, by = \"HHID\")\n\nThe result is an enriched dataset with rows from the ihs5_household_identifiers data that match the HHID column in the ihs5_consumption data. The by argument tells the left_join function which column to use to match the rows. If the column names are the same in both dataframes, we do not need to specify the by argument. For example, to join the ihs5_consumption data with the ihs5_household_identifies contained in hh_mod_a_filt_vMAPS.dta data we would type:\n\n# Import the data\nihs5_household_identifiers &lt;-\n    read_dta(here::here(\"data\",\n                        \"mwi-ihs5-sample-data\", \n                        \"hh_mod_a_filt_vMAPS.dta\"))\n\n# Join the data\nihs5_consumption &lt;- ihs5_consumption |&gt;\n    left_join(ihs5_household_identifiers)\n\n\n\n\n\n\n\nExcercise\n\n\n\n\nCompare the results of the two joins.\nWhat is the difference?\n\n\n\n\n\n5.3.5 Grouping and Summarising Data\nWe can group data using the group_by function. Grouping data is useful when we want to summarise data. In dplyr the summaries are created from the groups in the data. For eample to summarise the consumption_per_person by food_item we would type:\n\n# Summarise the data\nihs5_consumption_summary &lt;- ihs5_consumption |&gt;\n    group_by(food_item) |&gt;\n    summarise(consumption_per_person = mean(consumption_per_person, na.rm = TRUE))\n\nHere we are using the mean function to calculate the mean of the consumption_per_person column. The na.rm = TRUE argument tells the mean function to ignore missing values.\nWe can also compute multiple summaries at once. For example, to compute the mean and standard deviation of the consumption_per_person column we would type:\n\n# Summarise the data\nihs5_consumption_summary &lt;- ihs5_consumption |&gt;\n    group_by(food_item) |&gt;\n    summarise(\n        consumption_per_person_mean = mean(consumption_per_person, na.rm = TRUE),\n        consumption_per_person_sd = sd(consumption_per_person, na.rm = TRUE)\n    )\n\nTo compute summaries across multiple groups we can use the group_by function with multiple arguments. For example, to compute the mean and standard deviation of the consumption_per_person column by food_item and region we would type:\n\n# Summarise the data\nihs5_consumption_summary &lt;- ihs5_consumption |&gt;\n    group_by(food_item, region) |&gt;\n    summarise(\n        consumption_per_person_mean = mean(consumption_per_person, na.rm = TRUE),\n        consumption_per_person_sd = sd(consumption_per_person, na.rm = TRUE)\n    )\n\nIn the next section we will learn how to use plots to visualise our data. A basic example of a plot is a bar chart. For example we can visualise the consumption per person by food item using a bar chart. To do this we will use the ggplot2 package from the tidyverse package like so:\n\n# Load the ggplot2 package\nlibrary(ggplot2)\n\n#  Plot the data\nihs5_consumption |&gt;\n    # Add plot aesthetics\n    ggplot(aes(x = region, y = consumption_per_person, group = region)) +\n    # Add plot type\n    geom_boxplot() \n\nHere we plotted a boxplot of the consumption_per_person by region.\n\n\n5.3.6 Data Output/Export\nWe can export data from R using the write_csv() function from the readr package. For example, to export the ihs5_consumption data to a csv file called ihs5_consumption.csv stored in our working directory we run:\n\n# Export the data\nreadr::write_csv(ihs5_consumption, here::here(\"data\",\n                                       \"ihs5_consumption.csv\"))\n\nWe recommend exporting files to csv as this allows interoperability between various software. If you prefer exporting your data to excel, you can use the write_xlsx() function from the writexl package. For example, to export the ihs5_consumption data to an excel file called ihs5_consumption.xlsx stored in our working directory we run:\n\n# Export the data\nwritexl::write_xlsx(ihs5_consumption, here::here(\"ihs5_consumption.xlsx\"))\n\nTo export the data to a stata file, we can use the write_dta() function from the haven package. For example, to export the ihs5_consumption data to a stata file called ihs5_consumption.dta stored in our working directory we run:\n\n# Export the data\nwrite_dta(ihs5_consumption, here::here(\"ihs5_consumption.dta\"))",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Data I/O and Wrangling</span>"
    ]
  },
  {
    "objectID": "fct_harmonisation.html",
    "href": "fct_harmonisation.html",
    "title": "9  Food composition harmonisation and food matching",
    "section": "",
    "text": "9.1 Introduction",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Food composition harmonisation and food matching</span>"
    ]
  },
  {
    "objectID": "sample_data.html",
    "href": "sample_data.html",
    "title": "10  Appendix A: Sample Data",
    "section": "",
    "text": "10.1 Introduction\nThe sample data used in this book was generated from the Malawi Intergrated Household Survey Fifth Edition 2018-2019 downloaded from here.\nThe data was generated randomly using the following code:",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Appendix A: Sample Data</span>"
    ]
  }
]